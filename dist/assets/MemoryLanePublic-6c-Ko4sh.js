import{a as i,j as t,H as ye,L as ke}from"./app-CpTrn_zj.js";import{S as Ee}from"./SecretCodeGate-CjnjNA1B.js";import{G as Ce}from"./gift-BiEUzxEw.js";import"./createLucideIcon-C0075d5o.js";const De="/images/example-image-tajen.jpg",ie=()=>Math.random()>.5?1:-1,Ge=r=>{let a=0;for(let n=0;n<r.length;n+=1)a=(a<<5)-a+r.charCodeAt(n),a|=0;return a},Re=(r,a)=>{const n=Ge(`${r}:${a}`),o=Math.sin(n)*1e4;return o-Math.floor(o)},T=(r,a,n,o)=>n+Re(r,a)*(o-n),I=(r,a,n)=>Math.min(n,Math.max(a,r)),_e=(r,a,n,o)=>{const c=o,d=o,p=o+a,h=o+a,b=a/3,j=n*.6,P=x=>{if(x===0)return`L ${p} ${d}`;const s=c+b,u=c+2*b;return[`L ${s} ${d}`,`C ${s+j} ${d-x*n} ${u-j} ${d-x*n} ${u} ${d}`,`L ${p} ${d}`].join(" ")},m=x=>{if(x===0)return`L ${p} ${h}`;const s=d+b,u=d+2*b;return[`L ${p} ${s}`,`C ${p+x*n} ${s+j} ${p+x*n} ${u-j} ${p} ${u}`,`L ${p} ${h}`].join(" ")},$=x=>{if(x===0)return`L ${c} ${h}`;const s=c+2*b,u=c+b;return[`L ${s} ${h}`,`C ${s-j} ${h+x*n} ${u+j} ${h+x*n} ${u} ${h}`,`L ${c} ${h}`].join(" ")},g=x=>{if(x===0)return`L ${c} ${d}`;const s=d+2*b,u=d+b;return[`L ${c} ${s}`,`C ${c-x*n} ${s-j} ${c-x*n} ${u+j} ${c} ${u}`,`L ${c} ${d}`].join(" ")};return[`M ${c} ${d}`,P(r.top),m(r.right),$(r.bottom),g(r.left),"Z"].join(" ")},Be=160,Te=60,We=720,Ae=(r,a)=>{const n=Math.floor(We/(a*1.5)),o=Math.min(Be,Math.max(Te,n)),c=o/4,d=c,p=o+d*2,h=o*a,b=o*r,j=[],P=Array.from({length:r},()=>Array.from({length:a},()=>({top:0,right:0,bottom:0,left:0})));for(let m=0;m<r;m+=1)for(let $=0;$<a;$+=1){const g=m===0?0:P[m-1][$].bottom*-1,x=$===0?0:P[m][$-1].right*-1,s=$===a-1?0:ie(),u=m===r-1?0:ie(),E={top:g,right:s,bottom:u,left:x};P[m][$]=E,j.push({id:`${m}-${$}`,row:m,col:$,connectors:E,path:_e(E,o,c,d)})}return{pieces:j,base:o,knob:c,offset:d,dimension:p,rows:r,cols:a,boardWidth:h,boardHeight:b}},Y=(r,a)=>`cell-${r}-${a}`,He=r=>{const a=[...r];for(let n=a.length-1;n>0;n-=1){const o=Math.floor(Math.random()*(n+1));[a[n],a[o]]=[a[o],a[n]]}return a},ce=(r,a)=>{const n={};for(let o=0;o<r;o+=1)for(let c=0;c<a;c+=1)n[Y(o,c)]=null;return n},Oe=(r,a)=>{const n=r.pieces.length,o=Math.min(Math.max(a,1),n),d=He(r.pieces.map(h=>h.id)).slice(0,o),p=ce(r.rows,r.cols);return r.pieces.forEach(h=>{const b=Y(h.row,h.col);p[b]=d.includes(h.id)?null:h.id}),{placements:p,missingPieces:d}};function Xe({children:r,imageUrl:a,rows:n=3,cols:o=3,missingCount:c=5,title:d="Assemble our secret puzzle",description:p="Slide the missing pieces onto the board until the picture is whole.",solvedTitle:h="Puzzle complete!",solvedDescription:b="Ready for the next surprise.",onSolved:j,resetLabel:P="Shuffle puzzle pieces",controls:m,pretitle:$="Mini game",dragLabel:g="Drag each piece to the correct slot.",movesLabel:x="Moves"}){const s=i.useMemo(()=>Ae(n,o),[n,o]),[u,E]=i.useState(()=>ce(n,o)),[C,de]=i.useState([]),[S,D]=i.useState(null),[L,Q]=i.useState(0),[he,Z]=i.useState(null),[xe,ee]=i.useState(!1),te=a??De,se=`${i.useId().replace(/:/g,"")}-outline`,[y,ue]=i.useState(()=>`${Date.now()}`),U=i.useCallback(()=>{const{placements:e,missingPieces:l}=Oe(s,c);E(e),de(l),D(null),Q(0),Z(null),ee(!1),O.current.clear(),ue(`${Date.now()}-${Math.random()}`)},[s,c]);i.useEffect(()=>{U()},[U,a]);const W=i.useMemo(()=>{const e=new Map;return s.pieces.forEach(l=>e.set(l.id,l)),e},[s.pieces]),fe=i.useMemo(()=>C.map(e=>W.get(e)).filter(e=>!!e).filter(e=>!Object.values(u).some(l=>l===e.id)),[C,W,u]),pe=Math.min(s.boardWidth+96,960),J=i.useMemo(()=>Math.max(Math.round(s.base*.1),8),[s.base]),N=i.useMemo(()=>s.dimension+J*2,[s.dimension,J]),A=N*2.4+48,me=Math.max(4,Math.ceil(s.pieces.length/4)),H=N*Math.min(me,12),R=i.useRef(1),re=i.useCallback(e=>({topFactor:T(`${y}-${e.id}`,"top",.05,.95),leftFactor:T(`${y}-${e.id}`,"left",.05,.95),zIndex:R.current++}),[y]),_=i.useMemo(()=>{const e=new Map;return s.pieces.forEach(l=>{e.set(l.id,re(l))}),e},[s.pieces,re]),[ge,V]=i.useState(_);i.useEffect(()=>{V(new Map(_))},[_]),i.useEffect(()=>{let e=0;_.forEach(l=>{l.zIndex>e&&(e=l.zIndex)}),e>=R.current&&(R.current=e+1)},[_]);const le=i.useMemo(()=>{const e=new Set;return Object.values(u).forEach(l=>{l&&e.add(l)}),e},[u]),ae=i.useRef(null),G=i.useRef({}),O=i.useRef(new Set),ne=i.useCallback(e=>{V(l=>{const f=l.get(e);if(!f||f.zIndex===R.current-1)return l;const w=new Map(l);return w.set(e,{...f,zIndex:R.current++}),w})},[]),X=i.useCallback((e,l)=>{const f=W.get(e);if(!f||!C.includes(e))return;const w=l.match(/cell-(\d+)-(\d+)/);if(!w)return;const[,v,k]=w;if(f.row!==Number(v)||f.col!==Number(k)){Z(l),setTimeout(()=>{Z(z=>z===l?null:z)},500);return}O.current.add(e),delete G.current[e],E(z=>({...z,[l]:e})),D(null),Q(z=>z+1)},[C,W]),be=i.useCallback((e,l)=>{e.preventDefault();const f=e.dataTransfer.getData("text/plain");f&&X(f,l)},[X]),we=i.useCallback(e=>{S&&X(S,e)},[X,S]),je=i.useCallback((e,l)=>{e.dataTransfer.setData("text/plain",l),e.dataTransfer.effectAllowed="move",G.current[l]={x:e.clientX||e.pageX||0,y:e.clientY||e.pageY||0},D(l)},[]),$e=i.useCallback((e,l)=>{const f=e.clientX||e.pageX||0,w=e.clientY||e.pageY||0;f===0&&w===0&&G.current[l]||(G.current[l]={x:f,y:w})},[]),ve=i.useCallback((e,l)=>{const f=G.current[l];if(delete G.current[l],O.current.has(l)||le.has(l)){O.current.delete(l);return}const w=ae.current;if(!w)return;const v=w.getBoundingClientRect();let k=e.clientX||e.pageX||f?.x||0,z=e.clientY||e.pageY||f?.y||0;k===0&&z===0&&(k=v.left+v.width*T(`${y}-${l}`,"fallback-x",.1,.9),z=v.top+v.height*T(`${y}-${l}`,"fallback-y",.1,.9));const q=Math.max(v.width,A),K=Math.max(v.height,H),B=Math.max(q-N,0),M=Math.max(K-N,0),Ne=I(k-v.left-N/2,0,B),Me=I(z-v.top-N/2,0,M),Pe=B>0?Ne/B:.5,Se=M>0?Me/M:.5;V(F=>{const oe=new Map(F);return oe.set(l,{topFactor:Se,leftFactor:Pe,zIndex:Math.round(T(`${y}-${l}`,"z-adjust",60,140))}),oe}),D(F=>F===l?null:F)},[le,N,y,A,H,D]);if(i.useEffect(()=>{Object.values(u).every(l=>l!==null)&&C.length>0&&(ee(!0),j?.())},[C.length,j,u]),xe)return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"rounded-3xl border border-white/25 bg-white/10 p-6 text-center text-white backdrop-blur",children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.32em] text-white/60",children:"Stage unlocked"}),t.jsx("h2",{className:"mt-3 text-2xl font-bold",children:h}),t.jsx("p",{className:"mt-4 text-sm text-white/70",children:b}),t.jsxs("p",{className:"mt-4 text-xs uppercase tracking-[0.28em] text-white/50",children:["Total langkah: ",L]})]}),m?t.jsx("div",{className:"flex flex-wrap justify-center gap-3",children:m}):null,r]});const ze=e=>{const l=ge.get(e.id),f=Math.max(H-N,0),w=Math.max(A-N,0),v=l?I(l.topFactor,0,1):.5,k=l?I(l.leftFactor,0,1):.5,z=v*f,q=k*w,K=S===e.id?250:l?.zIndex??30,B={width:N,height:N,padding:J,position:"absolute",top:z,left:q,transform:S===e.id?"scale(1.05)":"scale(1)",transformOrigin:"50% 50%",zIndex:K,boxShadow:S===e.id?"0 16px 32px rgba(15,23,42,0.45)":"0 10px 24px rgba(15,23,42,0.35)",transition:"transform 220ms ease, box-shadow 220ms ease"};return t.jsx("button",{type:"button",draggable:!0,onDragStart:M=>je(M,e.id),onDrag:M=>$e(M,e.id),onDragEnd:M=>ve(M,e.id),onPointerDown:()=>ne(e.id),onFocus:()=>ne(e.id),onClick:()=>D(e.id),className:"group absolute cursor-grab overflow-hidden rounded-[1.6rem] border border-white/25 bg-white/10 transition-shadow duration-200 ease-out active:cursor-grabbing",style:B,children:t.jsxs("svg",{width:s.dimension,height:s.dimension,viewBox:`0 0 ${s.dimension} ${s.dimension}`,style:{width:s.dimension,height:s.dimension},children:[t.jsx("defs",{children:t.jsx("clipPath",{id:`pool-${e.id}`,children:t.jsx("path",{d:e.path})})}),t.jsx("image",{clipPath:`url(#pool-${e.id})`,href:te,x:s.offset-e.col*s.base,y:s.offset-e.row*s.base,width:s.base*o+s.offset*2,height:s.base*n+s.offset*2}),t.jsx("path",{d:e.path,fill:"none",stroke:"rgba(255,255,255,0.85)",strokeWidth:1.5})]})},e.id)};return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"space-y-3 text-center",children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.32em] text-white/60",children:$}),t.jsx("h2",{className:"text-2xl font-bold text-white",children:d}),t.jsx("p",{className:"text-sm text-white/70",children:p})]}),m?t.jsx("div",{className:"flex flex-wrap justify-center gap-3",children:m}):null,t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-white/60 text-center lg:text-left",children:g}),t.jsxs("div",{className:"flex flex-col items-center gap-8 lg:flex-row lg:items-start lg:justify-start lg:gap-16 lg:pl-6",children:[t.jsxs("div",{className:"flex flex-col items-center gap-6 lg:-ml-8 lg:-mr-6",children:[t.jsxs("div",{className:"relative w-full rounded-[2.5rem] border border-white/15 bg-white/10 p-6 shadow-[0_24px_45px_rgba(15,23,42,0.25)] backdrop-blur",style:{maxWidth:`min(90vw, ${pe}px)`},children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-[2.5rem] border border-white/20"}),t.jsxs("div",{className:"relative mx-auto overflow-visible rounded-[2rem] bg-slate-900 shadow-inner shadow-black/35",style:{padding:24,width:s.boardWidth+48,height:s.boardHeight+48},children:[t.jsxs("svg",{width:s.boardWidth,height:s.boardHeight,viewBox:`0 0 ${s.boardWidth} ${s.boardHeight}`,className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:se,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(99,102,241,0.6)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(244,114,182,0.6)"})]}),s.pieces.map(e=>t.jsx("clipPath",{id:`clip-${e.id}`,children:t.jsx("path",{d:e.path,transform:`translate(${e.col*s.base-s.offset} ${e.row*s.base-s.offset})`})},e.id))]}),t.jsx("image",{href:te,x:0,y:0,width:s.boardWidth,height:s.boardHeight,preserveAspectRatio:"xMidYMid slice"}),s.pieces.map(e=>t.jsx("path",{d:e.path,transform:`translate(${e.col*s.base-s.offset} ${e.row*s.base-s.offset})`,fill:"none",stroke:`url(#${se})`,strokeWidth:2.4,opacity:.85},`outline-${e.id}`)),s.pieces.map(e=>{const l=Y(e.row,e.col);return u[l]?null:t.jsx("path",{d:e.path,transform:`translate(${e.col*s.base-s.offset} ${e.row*s.base-s.offset})`,fill:"rgba(15,23,42,0.72)"},`mask-${e.id}`)})]}),t.jsx("div",{className:"absolute left-1/2 top-1/2 grid -translate-x-1/2 -translate-y-1/2",style:{width:s.boardWidth,height:s.boardHeight,gridTemplateColumns:`repeat(${o}, ${s.base}px)`,gridTemplateRows:`repeat(${n}, ${s.base}px)`},children:s.pieces.map(e=>{const l=Y(e.row,e.col),f=u[l]===e.id;return t.jsx("div",{onDragOver:w=>w.preventDefault(),onDrop:w=>be(w,l),onClick:()=>we(l),className:`relative flex h-full w-full items-center justify-center rounded-[1.85rem] transition ${f?"":he===l?"ring-2 ring-rose-400/80":S?"ring-1 ring-white/40":""}`},l)})})]})]}),t.jsxs("div",{className:"flex w-full max-w-sm flex-col items-center gap-3 rounded-[1.8rem] border border-white/15 bg-white/6 px-4 py-5 text-xs uppercase tracking-[0.28em] text-white/75",children:[t.jsxs("span",{children:[x,": ",L]}),t.jsx("button",{type:"button",onClick:U,className:"rounded-full border border-white/30 px-5 py-2 text-[0.65rem] font-semibold uppercase tracking-[0.3em] text-white transition hover:border-white/55 hover:bg-white/15",children:P})]})]}),t.jsxs("div",{ref:ae,className:"relative w-full overflow-visible rounded-[2.5rem] border border-white/15 bg-white/12 text-white shadow-[0_18px_30px_rgba(15,23,42,0.2)] backdrop-blur lg:w-auto lg:flex-shrink-0",style:{maxWidth:`${A}px`,height:H},children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-[2.5rem] border border-white/15"}),fe.map(e=>ze(e))]})]})]})}function Je({memoryLane:r,space:a}){const n=a?.slug?route("surprise.story.space",{space:a.slug}):route("surprise.story"),o=r.puzzle.grid.rows??4,c=r.puzzle.grid.cols??4,d=o*c,p=r.puzzle.options,h=p.length>0?p:[{label:"",value:""}],[b,j]=i.useState(0),m=(h[b]??h[0])?.value??h[0]?.value,$=()=>h.map((g,x)=>{const s=x===b;return t.jsx("button",{type:"button","aria-pressed":s,onClick:()=>j(x),className:`rounded-full border px-4 py-2 text-xs font-semibold uppercase tracking-[0.28em] transition ${s?"border-white/80 bg-white/20 text-white shadow-[0_12px_26px_rgba(15,23,42,0.35)]":"border-white/25 text-white/70 hover:border-white/45 hover:text-white"}`,children:g.label},g.value)});return t.jsxs("div",{className:"relative min-h-screen overflow-hidden bg-slate-900 text-white",children:[t.jsx(ye,{title:r.headTitle}),t.jsx("div",{className:"absolute inset-0 -z-20 bg-gradient-to-br from-rose-500/30 via-slate-900 to-amber-500/40"}),t.jsx("div",{className:"absolute left-[-120px] top-[-160px] -z-10 h-[500px] w-[500px] rounded-full bg-rose-400/30 blur-3xl"}),t.jsx("div",{className:"absolute right-[-160px] bottom-[-200px] -z-10 h-[560px] w-[560px] rounded-full bg-purple-500/30 blur-3xl"}),t.jsx(Ee,{code:r.secretGate.code,title:r.secretGate.title,description:r.secretGate.description,placeholder:r.secretGate.placeholder,buttonLabel:r.secretGate.buttonLabel,errorMessage:r.secretGate.errorMessage,hint:r.secretGate.hint,hintLabel:r.secretGate.hintLabel,accessLabel:r.secretGate.accessLabel,inputLabel:r.secretGate.inputLabel,children:t.jsxs("div",{className:"relative mx-auto flex min-h-screen w-full max-w-6xl flex-col px-4 py-16 sm:px-8 md:px-12",children:[t.jsx("div",{className:"mb-6 flex flex-col items-center gap-3 text-center sm:mb-8 sm:flex-row sm:justify-center"}),t.jsx(Xe,{rows:o,cols:c,missingCount:d,imageUrl:m,title:r.puzzle.title,description:r.puzzle.description,solvedTitle:r.puzzle.solvedTitle,solvedDescription:r.puzzle.solvedDescription,resetLabel:r.puzzle.resetLabel,pretitle:r.puzzle.pretitle,dragLabel:r.puzzle.dragLabel,movesLabel:r.puzzle.movesLabel,controls:$(),children:t.jsxs("div",{className:"flex flex-col gap-16",children:[t.jsxs("header",{className:"flex flex-col items-center gap-5 text-center",children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.48em] text-white/60",children:r.intro.tagline}),t.jsx("h1",{className:"text-3xl font-bold leading-tight sm:text-4xl",children:r.intro.title}),t.jsx("p",{className:"max-w-2xl text-sm text-white/70 sm:text-base",children:r.intro.description})]}),t.jsxs("section",{className:"space-y-6",children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-white/60",children:r.intro.stepsHeading}),t.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:r.steps.map((g,x)=>t.jsxs("div",{className:"flex h-full flex-col justify-between rounded-3xl border border-white/20 bg-white/10 p-6 backdrop-blur transition hover:border-white/30 hover:bg-white/15",children:[t.jsxs("span",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/25 text-sm font-semibold text-white",children:["0",x+1]}),t.jsxs("div",{className:"mt-4 space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:g.title}),t.jsx("p",{className:"text-sm leading-6 text-white/70",children:g.prompt})]}),t.jsxs("div",{className:"mt-5 rounded-2xl border border-dashed border-white/25 bg-black/20 px-4 py-3 text-xs text-white/70",children:[t.jsx("span",{className:"font-semibold text-white",children:r.intro.challengeLabel})," ",g.action]})]},g.id))})]}),t.jsxs("section",{className:"space-y-6",children:[t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.28em] text-white/60",children:r.intro.tokensHeading}),t.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:r.tokens.map(g=>t.jsxs("div",{className:"rounded-3xl border border-white/20 bg-white/10 p-5 text-sm text-white/80 backdrop-blur transition hover:border-white/35 hover:bg-white/15",children:[t.jsx("div",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${g.accent}`,children:g.label}),t.jsx("p",{className:"mt-3 leading-6",children:g.detail})]},g.label))})]}),t.jsxs("section",{className:"space-y-6 rounded-3xl border border-white/20 bg-black/20 p-6 text-sm text-white/70 backdrop-blur",children:[t.jsx("p",{children:r.intro.closing.description}),t.jsxs("div",{className:"flex flex-col gap-4 rounded-2xl border border-white/15 bg-white/10 p-5 text-white",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("span",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-rose-500/20 text-rose-100",children:t.jsx(Ce,{className:"h-6 w-6"})}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:r.intro.closing.story.title}),t.jsx("p",{className:"text-sm text-white/70",children:r.intro.closing.story.description})]})]}),t.jsx("div",{children:t.jsx(ke,{href:n,className:"inline-flex items-center justify-center rounded-full bg-rose-500 px-6 py-3 text-sm font-semibold text-white transition hover:bg-rose-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-300 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-900",children:r.intro.closing.story.button})})]}),t.jsx("p",{className:"text-center text-xs text-white/60",children:r.intro.closing.footnote})]})]})})]})})]})}export{Je as default};
