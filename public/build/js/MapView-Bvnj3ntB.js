import{r as e,ak as a,j as t,aK as s,aL as n,aM as i,aN as l,aO as r,aP as o,aQ as d}from"./vendor-DtplsvIg.js";import{a as c}from"./games-C9PD58Ia.js";import{S as u}from"./inertia-BRtPwdNN.js";import{p,r as m,s as x,O as g}from"./ui-libs-CxG7ASKr.js";import"./animation-BDJwZp_N.js";const h=[-2.5489,118.0149],b=({primaryColor:e,iconColor:a})=>l.divIcon({className:"custom-leaflet-marker",html:`\n            <div style="\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 6px;\n            ">\n                <span style="\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    width: 44px;\n                    height: 44px;\n                    border-radius: 9999px;\n                    background: #ffffff;\n                    border: 4px solid ${e};\n                    box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);\n                ">\n                    <svg\n                        xmlns="http://www.w3.org/2000/svg"\n                        viewBox="0 0 24 24"\n                        width="22"\n                        height="22"\n                        fill="none"\n                        stroke="${a}"\n                        stroke-width="1.8"\n                        stroke-linecap="round"\n                        stroke-linejoin="round"\n                    >\n                        <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/>\n                        <circle cx="12" cy="10" r="3"/>\n                    </svg>\n                </span>\n                <span style="\n                    width: 10px;\n                    height: 10px;\n                    border-radius: 9999px;\n                    background: ${e};\n                    opacity: 0.85;\n                    box-shadow: 0 3px 10px rgba(15, 23, 42, 0.25);\n                "></span>\n            </div>\n        `,iconSize:[46,60],iconAnchor:[23,56],tooltipAnchor:[0,-48],popupAnchor:[0,-48]}),y=b({primaryColor:"#ec4899",iconColor:"#db2777"}),f=b({primaryColor:"#8b5cf6",iconColor:"#7c3aed"});function w({center:a}){const t=d();return e.useEffect(()=>{t.setView(a)},[a,t]),null}function k(e,a,t,s){const n=e=>e*Math.PI/180,i=n(t-e),l=n(s-a),r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n(e))*Math.cos(n(t))*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371}function j(e){if(!e)return null;try{return new Intl.DateTimeFormat("id-ID",{dateStyle:"medium",timeStyle:"short"}).format(new Date(e))}catch(a){return null}}function N({auth:l,partner:d,userLocation:b,partnerLocation:N,shareBaseUrl:v,pendingInvitation:C,space:S}){const[M,$]=e.useState(b),[F,P]=e.useState(N),[L,E]=e.useState(b?.updated_at??null),[T,I]=e.useState(N?.updated_at??null),[B,_]=e.useState(!1),[A,O]=e.useState(!1),[R,K]=e.useState(!1),[U,q]=e.useState(!1),[z,D]=e.useState(null),Y=e.useMemo(()=>{if("undefined"==typeof window)return v;try{const e=new URL(v);return e.protocol=window.location.protocol,e.host=window.location.host,e.toString()}catch(e){return`${window.location.origin}/location/${S.slug}`}},[v,S.slug]),[H,J]=e.useState(!1),[X,Q]=e.useState(null),[V,W]=e.useState(d),Z=Boolean(V?.email),[G,ee]=e.useState(!1),[ae,te]=e.useState(!1),[se,ne]=e.useState(""),[ie,le]=e.useState(""),[re,oe]=e.useState(C),[de,ce]=e.useState(C?.email??null),[ue,pe]=e.useState(null),[me,xe]=e.useState(null);e.useEffect(()=>{oe(C),ce(C?.email??null)},[C]);const[ge,he]=e.useState(!1),[be,ye]=e.useState(null),[fe,we]=e.useState(null),ke=e.useRef(),je=e.useRef(null),Ne=e.useRef(null);e.useEffect(()=>(_(!0),()=>{ke.current&&window.clearTimeout(ke.current)}),[]),e.useEffect(()=>{B&&M&&je.current&&je.current.openPopup()},[B,M]),e.useEffect(()=>{B&&V&&F&&Ne.current&&Ne.current.openPopup()},[B,V,F]);const ve=e.useCallback((e,a)=>{Q({message:e,type:a}),ke.current&&window.clearTimeout(ke.current),ke.current=window.setTimeout(()=>{Q(null)},4e3)},[]),Ce=e.useCallback(async(e=!1)=>{if(V)try{const t=await a.get(`/api/location/${V.id}`),s=t.data.location?{latitude:t.data.location.latitude,longitude:t.data.location.longitude,updated_at:t.data.location.updated_at}:null;P(s),I(s?.updated_at??null),!e&&s&&ve("Lokasi pasangan diperbarui ðŸ’•","success")}catch(t){e||ve("Failed to fetch partner location.","error")}},[V,ve]),Se=e.useCallback(async e=>{e.preventDefault(),pe(null),ee(!0);try{const e=se.trim(),t=ie.trim();if(!e||!t)return void ve("Nama dan email pasangan wajib diisi.","error");const s=(await a.post(`/api/spaces/${S.slug}/connect-partner`,{partner_name:e,partner_email:t})).data,n=s.invitation??null;oe(n),ce(n?.email??s.partner_account?.email??t),pe(s.temporary_password??null),ve("Invitation sent successfully. Ask your partner to confirm.","success"),te(!1),ne(""),le("")}catch(t){let e="Failed to connect partner.";if(a.isAxiosError(t)){const a=t.response?.data,s=a?.errors?Object.values(a.errors).flat().find(e=>"string"==typeof e):void 0;s?e=s:"string"==typeof a?.message&&""!==a.message.trim()&&(e=a.message)}ve(e,"error")}finally{ee(!1)}},[ie,se,ve,S.slug]),Me=e.useCallback(async(e,t,s)=>{try{const n=(await a.post("/api/location/update",{latitude:e,longitude:t})).data.location;$(n),E(n.updated_at??null),s||ve("Your location updated successfully ðŸ’–","success"),await Ce(!0)}catch(n){s||ve("Failed to update location.","error")}finally{s||O(!1)}},[Ce,ve]),$e=e.useCallback(async e=>{try{const a=await fetch("https://ipapi.co/json/"),t=await a.json();if(!t?.latitude||!t?.longitude)throw new Error("IP geolocation did not return coordinates");await Me(Number(t.latitude),Number(t.longitude),e),e||ve("Menggunakan lokasi berdasarkan alamat IP.","warning")}catch(a){e||ve("Tidak dapat mengambil lokasi otomatis.","error"),e||O(!1)}},[Me,ve]),Fe=e.useCallback((e={})=>{const a=e.silent??!1;a||O(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{Me(e.coords.latitude,e.coords.longitude,a)},()=>{$e(a)},{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}):$e(a)},[$e,Me]),Pe=e.useCallback(()=>{const e=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return e?decodeURIComponent(e[1]):null},[]),Le=e.useCallback(async()=>{Pe()||await a.get("/sanctum/csrf-cookie",{withCredentials:!0});const e=Pe();e&&(a.defaults.headers.common["X-XSRF-TOKEN"]=e)},[Pe]);e.useEffect(()=>{if(!B)return;(async()=>{await Le(),Fe({silent:!0}),Ce(!0)})();const e=window.setInterval(()=>{Fe({silent:!0}),Ce(!0)},3e4);return()=>{window.clearInterval(e)}},[Le,Ce,B,Fe]);const Ee=e.useMemo(()=>M?[M.latitude,M.longitude]:F?[F.latitude,F.longitude]:h,[F,M]),Te=e.useMemo(()=>M&&F?k(M.latitude,M.longitude,F.latitude,F.longitude):null,[F,M]),Ie=e.useMemo(()=>null!==fe?fe:Te,[fe,Te]),Be=e.useMemo(()=>j(L),[L]),_e=e.useMemo(()=>j(T),[T]),Ae=e.useCallback(async(e,a)=>{he(!0),ye(null);try{const t=await fetch(`https://router.project-osrm.org/route/v1/driving/${e.longitude},${e.latitude};${a.longitude},${a.latitude}?overview=full&geometries=geojson`);if(!t.ok)throw new Error(`OSRM request failed with status ${t.status}`);const s=await t.json(),n=s.routes?.[0],i=n?.geometry?.coordinates;if(i&&Array.isArray(i)&&i.length>0){const t=i.map(([e,a])=>[a,e]);xe(t),we("number"==typeof n?.distance?n.distance/1e3:k(e.latitude,e.longitude,a.latitude,a.longitude))}else xe([[e.latitude,e.longitude],[a.latitude,a.longitude]]),we(k(e.latitude,e.longitude,a.latitude,a.longitude)),ye("Rute jalan tidak tersedia, menampilkan garis lurus.")}catch(t){xe([[e.latitude,e.longitude],[a.latitude,a.longitude]]),we(k(e.latitude,e.longitude,a.latitude,a.longitude)),ye("Failed to load road route, showing straight line.")}finally{he(!1)}},[]);e.useEffect(()=>{if(B)return M&&F?void Ae(M,F):(xe(null),we(null),void ye(null))},[Ae,B,F,M]);const Oe=e.useCallback(()=>{if(!M)return void ve("Lokasi belum tersedia. Tekan update lokasi terlebih dahulu.","warning");V||ve("Partner not connected on MySpaceLove yet. You can still copy the location link.","warning");const e=`${Y}?lat=${M.latitude}&lng=${M.longitude}`;D(e),q(!0)},[V,Y,ve,M]),Re=e.useCallback(()=>{q(!1),D(null)},[]),Ke=e.useCallback(async()=>{if(M&&z){K(!0);try{await a.post("/api/location/update",{latitude:M.latitude,longitude:M.longitude});let s=!1;if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(z),s=!0}catch(e){}if(!s)try{const e=document.createElement("textarea");e.value=z,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select(),s=document.execCommand("copy"),document.body.removeChild(e)}catch(t){}s?(ve("Link lokasi tersalin ke clipboard!","success"),Re()):ve("Tidak bisa menyalin otomatis. Salin link secara manual dari kotak di atas.","warning")}catch(s){ve("Failed to copy location link.","error")}finally{K(!1)}}else Re()},[Re,z,ve,M]),Ue=e.useCallback(async()=>{if(M&&z)if(V?.email){K(!0);try{await a.post(`/api/spaces/${S.slug}/location/share`,{latitude:M.latitude,longitude:M.longitude,url:z}),ve("Location link sent to partner's email successfully.","success"),Re()}catch(e){ve("Failed to send location email.","error")}finally{K(!1)}}else ve("Tidak ada email pasangan yang terhubung. Salin link lokasi sebagai gantinya.","warning");else Re()},[Re,V?.email,z,ve,S.slug,M]),qe=e.useCallback(async()=>{J(!0);try{await a.delete("/api/location"),$(null),E(null),ve("Stopped sharing location.","warning")}catch(e){ve("Failed to stop location sharing.","error")}finally{J(!1)}},[ve]);return t.jsxs(c,{header:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Berbagi Lokasi Pasangan ðŸ’ž"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Lihat posisi kalian berdua secara real-time."})]}),children:[t.jsx(u,{title:"Berbagi Lokasi"}),t.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 space-y-6",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm border border-pink-100",children:[t.jsxs("h3",{className:"mb-1 flex items-center gap-2 font-semibold text-gray-800",children:[t.jsx(p,{className:"h-4 w-4 text-pink-500"}),"You are here"]}),t.jsx("p",{className:"text-sm text-gray-600",children:M?`${M.latitude.toFixed(5)}, ${M.longitude.toFixed(5)}`:"No location yet"}),t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:Be?`Terakhir diperbarui: ${Be}`:"Belum pernah diperbarui"})]}),t.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm border border-violet-100",children:[t.jsxs("h3",{className:"mb-1 flex items-center gap-2 font-semibold text-gray-800",children:[t.jsx(p,{className:"h-4 w-4 text-purple-500"}),"Pasanganmu"]}),V?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm text-gray-600",children:F?`${F.latitude.toFixed(5)}, ${F.longitude.toFixed(5)}`:"No location yet"}),t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:_e?`Terakhir diperbarui: ${_e}`:"Menunggu pasangan update lokasi"})]}):t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Kirim undangan ke pasanganmu untuk mulai berbagi."}),re&&t.jsxs("div",{className:"rounded-lg border border-violet-200 bg-violet-50 px-3 py-2 text-xs text-violet-700",children:["Menunggu konfirmasi dari"," ",t.jsx("span",{className:"font-semibold",children:re.email}),". Mintalah pasanganmu untuk login dan menerima undangan yang sudah kamu kirim."]}),ae?t.jsxs("form",{className:"space-y-3 rounded-xl border border-violet-100 bg-violet-50 p-3",onSubmit:Se,children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Nama Pasangan"}),t.jsx("input",{value:se,onChange:e=>ne(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500",placeholder:"Misal: Hana"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Email Pasangan"}),t.jsx("input",{type:"email",value:ie,onChange:e=>le(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500",placeholder:"pasangan@email.com"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"submit",disabled:G,className:"inline-flex items-center justify-center rounded-full bg-purple-500 px-4 py-2 text-sm font-medium text-white shadow transition hover:bg-purple-600 disabled:cursor-not-allowed disabled:bg-purple-300",children:G?"Mengirim...":"Kirim Undangan"}),t.jsx("button",{type:"button",onClick:()=>{te(!1),ne(""),le("")},className:"inline-flex items-center justify-center rounded-full bg-white px-4 py-2 text-sm font-medium text-gray-600 shadow-sm transition hover:bg-gray-50",children:"Batal"})]})]}):t.jsx("button",{type:"button",onClick:()=>te(!0),className:"inline-flex items-center gap-2 rounded-full bg-purple-100 px-4 py-2 text-sm font-medium text-purple-600 transition hover:bg-purple-200",children:"Kirim Undangan ke Pasangan"})]})]})]}),ue&&de&&t.jsxs("div",{className:"rounded-2xl border border-yellow-200 bg-yellow-50 px-4 py-3 text-sm text-yellow-800 shadow-sm",children:[t.jsx("p",{className:"font-semibold",children:"Partner account created automatically."}),t.jsxs("p",{className:"mt-1",children:["Share these credentials with your partner to login:",t.jsx("br",{}),t.jsx("span",{className:"font-semibold",children:"Email:"})," ",de," ",t.jsx("span",{className:"font-semibold",children:"Password:"})," ",t.jsx("span",{className:"font-mono tracking-wide",children:ue})]})]}),null!==Ie&&t.jsx("div",{className:"rounded-2xl bg-gradient-to-r from-pink-500 to-purple-500 px-6 py-4 text-white shadow-lg",children:t.jsx("p",{className:"text-sm font-semibold",children:null!==fe?`Jarak estimasi via jalan sekitar ${Ie.toFixed(2)} km ðŸš—`:`Jarak garis lurus kalian sekitar ${Ie.toFixed(2)} km ðŸŒ`})}),t.jsxs("div",{className:"bg-white rounded-3xl shadow-lg border border-pink-100 p-4",children:[t.jsx("div",{className:"h-[420px] w-full overflow-hidden rounded-2xl",children:B?t.jsxs(s,{center:Ee,zoom:13,className:"h-full w-full",scrollWheelZoom:!0,children:[t.jsx(w,{center:Ee}),t.jsx(n,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),M&&t.jsx(i,{ref:je,position:[M.latitude,M.longitude],icon:y,children:t.jsxs(r,{autoClose:!1,closeButton:!1,closeOnClick:!1,autoPan:!1,children:[t.jsxs("span",{className:"inline-flex items-center gap-1 font-semibold text-pink-500",children:[t.jsx(p,{className:"h-4 w-4"}),"You are here"]}),t.jsx("br",{}),Be?`Last updated: ${Be}`:"No data yet"]})}),V&&F&&t.jsx(i,{ref:Ne,position:[F.latitude,F.longitude],icon:f,children:t.jsxs(r,{autoClose:!1,closeButton:!1,closeOnClick:!1,autoPan:!1,children:[t.jsxs("span",{className:"inline-flex items-center gap-1 font-semibold text-purple-500",children:[t.jsx(p,{className:"h-4 w-4"}),"Pasanganmu"]}),t.jsx("br",{}),_e?`Last updated: ${_e}`:"No data yet"]})}),me&&t.jsx(o,{positions:me,pathOptions:{color:"#ec4899",weight:5,opacity:.75,lineCap:"round",lineJoin:"round"}})]}):t.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500",children:"Memuat peta..."})}),(ge||be)&&t.jsxs("div",{className:"mt-3 px-1 space-y-1",children:[ge&&t.jsx("p",{className:"text-xs text-gray-500",children:"Menentukan jalur terbaik..."}),be&&t.jsx("p",{className:"text-xs text-yellow-600",children:be})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsx("button",{onClick:()=>Fe({silent:!1}),disabled:A,className:"inline-flex items-center gap-2 rounded-full bg-pink-500 px-5 py-2 text-white shadow transition hover:bg-pink-600 disabled:cursor-not-allowed disabled:bg-pink-300",children:A?"Memperbarui...":t.jsxs(t.Fragment,{children:[t.jsx(m,{className:"h-4 w-4"}),"Update Lokasi"]})}),t.jsx("button",{onClick:Oe,disabled:R,className:"inline-flex items-center gap-2 rounded-full bg-purple-500 px-5 py-2 text-white shadow transition hover:bg-purple-600 disabled:cursor-not-allowed disabled:bg-purple-300",children:R?"Mengirim...":t.jsxs(t.Fragment,{children:[t.jsx(x,{className:"h-4 w-4"}),"Share Lokasi"]})}),t.jsx("button",{onClick:qe,disabled:H,className:"inline-flex items-center gap-2 rounded-full bg-gray-200 px-5 py-2 text-gray-700 shadow transition hover:bg-gray-300 disabled:cursor-not-allowed disabled:opacity-70",children:H?"Memproses...":t.jsxs(t.Fragment,{children:[t.jsx(g,{className:"h-4 w-4"}),"Stop Sharing"]})})]}),U&&t.jsx("div",{className:"mt-4 w-full max-w-md rounded-2xl border border-purple-100 bg-white p-6 shadow-md",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-purple-900",children:"Bagikan Lokasi"}),t.jsx("p",{className:"text-sm text-purple-600",children:"Pilih cara berbagi titik lokasi ini dengan pasanganmu."})]}),z&&t.jsx("p",{className:"break-words rounded-2xl bg-purple-50 px-3 py-2 text-xs text-purple-500",children:z}),t.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[t.jsx("button",{type:"button",onClick:()=>{Ke()},disabled:R,className:"rounded-2xl border border-purple-200 bg-white px-4 py-3 text-sm font-semibold text-purple-600 shadow-sm transition hover:bg-purple-50 disabled:cursor-not-allowed disabled:opacity-60",children:"Salin Link"}),t.jsx("button",{type:"button",onClick:()=>{Ue()},disabled:R||!Z,className:"rounded-2xl border border-pink-200 bg-pink-500 px-4 py-3 text-sm font-semibold text-white shadow-sm transition hover:bg-pink-600 disabled:cursor-not-allowed disabled:opacity-60",children:"Kirim Email"})]}),!Z&&t.jsx("p",{className:"text-xs text-gray-500",children:"Hubungkan pasangan dan pastikan email-nya terisi untuk mengirim email otomatis."}),t.jsx("button",{type:"button",onClick:Re,disabled:R,className:"w-full rounded-2xl border border-gray-200 px-4 py-3 text-sm font-semibold text-gray-600 transition hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:"Tutup"})]})}),X&&t.jsx("div",{className:"fixed bottom-6 right-6 z-50 rounded-2xl px-4 py-3 text-sm shadow-lg transition "+("success"===X.type?"bg-white border border-green-200 text-green-600":"error"===X.type?"bg-white border border-red-200 text-red-600":"bg-white border border-yellow-200 text-yellow-600"),children:X.message})]})]})}export{N as default};
