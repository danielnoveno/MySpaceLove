import{r as e,aH as a,j as s,aI as t,al as r}from"./vendor-DXr22Lef.js";import{u as n,b as i}from"./games-RZpJ1ixc.js";import{S as l,x as o,A as c}from"./inertia-2axaVlnj.js";import{u as d}from"./animation-H0tefZHq.js";import{M as m}from"./Modal-zylAUIAi.js";import{T as u}from"./TextInput-Csn47xDX.js";import{I as x}from"./InputLabel-DWlAdalv.js";import{P as p}from"./PrimaryButton-B920ajAd.js";import{S as g}from"./SecondaryButton-CXuwt8Y9.js";import{u as h}from"./useCurrentSpace-CdnheA8Y.js";import{S as y,X as f,L as b}from"./ui-libs-D5k9l7B7.js";const j=({text:a,wordLimit:t,expandMoreLabel:r,expandLessLabel:n})=>{const[i,l]=e.useState(!1),o=a.split(" "),c=o.length>t,d=i?a:o.slice(0,t).join(" ")+(c?"...":"");return s.jsxs("div",{children:[s.jsx("p",{className:"mt-2 text-gray-700 text-justify "+(i?"":"max-h-24 overflow-hidden"),dangerouslySetInnerHTML:{__html:d}}),c&&s.jsx("button",{onClick:()=>l(!i),className:"text-pink-600 hover:text-pink-800 text-sm mt-2",children:i?n:r})]})};function w({messages:w,filters:k}){const v=h(),{translations:N}=n("daily_messages"),{t:S}=n("common");if(!v)return null;const C=v.slug,[I,M]=e.useState(!1),[T,L]=e.useState(k.search||""),[_,D]=e.useState(k.date||""),[A,z]=e.useState(null),[E,P]=e.useState(null),[R,B]=e.useState(null),H=e.useRef(null);e.useEffect(()=>()=>{H.current&&(window.clearTimeout(H.current),H.current=null)},[]),e.useEffect(()=>{R&&(H.current&&window.clearTimeout(H.current),H.current=window.setTimeout(()=>{B(null),H.current=null},6e3))},[R]);const K=e.useRef(null),Y=e.useRef(w.map(()=>({x:0,y:0}))).current,[F,$]=a(w.length,e=>({x:Y[e].x,y:Y[e].y,zIndex:1,config:{mass:1,tension:280,friction:60}})),G=d(({args:[e],down:a,movement:[s,t]})=>{Y[e]={x:s,y:t},$.start(r=>{if(e===r)return{x:a?s:Y[r].x,y:a?t:Y[r].y,zIndex:a?1e3:1,immediate:a}})});return s.jsxs(i,{header:s.jsx("h2",{className:"font-semibold text-xl text-gray-800",children:N.header??"Daily Message"}),children:[s.jsx(l,{title:N.meta?.title??"Daily Messages"}),s.jsxs("div",{className:"p-6 space-y-6 max-w-8xl mx-auto",children:[s.jsxs("div",{className:"p-4 flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-bold text-pink-700",children:N.title??"Pesan Harian Kita ðŸ’Œ"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>M(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md transition duration-200",children:N.actions?.search??"Cari Pesan"}),s.jsx(o,{href:route("daily.create",{space:C}),className:"bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg shadow-md transition duration-200",children:N.actions?.add_manual??"+ Tambah Manual"})]})]}),0===w.length?s.jsx("p",{className:"text-gray-500 text-center py-8",children:N.empty??"Belum ada pesan harian. AI akan generate otomatis! âœ¨"}):s.jsx("div",{ref:K,className:"grid grid-cols-1 md:grid-cols-3 gap-6 items-start",children:F.map((a,n)=>{const{x:i,y:l,zIndex:o}=a,d=w[n];return e.createElement(t.div,{...G(n),key:d.id,style:{x:i,y:l,zIndex:o.to(e=>Math.round(e)),touchAction:"none"},className:"p-4 bg-white shadow-md rounded-xl border border-gray-100 hover:shadow-xl transition duration-200 cursor-grab active:cursor-grabbing"},s.jsx("h4",{className:"font-semibold text-gray-800",children:d.date}),s.jsx("p",{className:"text-xs text-gray-500 mb-2",children:d.user?`From: ${d.user.name}`:""}),s.jsx(j,{text:(m=`"${d.message}"`,m.replace(/<[^>]*>/g,"").replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/\*(.*?)\*/g,"<strong>$1</strong>")),wordLimit:50,expandMoreLabel:N.expand?.more??"Baca selengkapnya",expandLessLabel:N.expand?.less??"Baca lebih sedikit"}),s.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[s.jsxs("button",{type:"button",onClick:()=>{(async e=>{if(null!==A)return;const a=String(e.id);z(a),P({title:"Regenerating message with AI...",description:"Tunggu sebentar, kami sedang membuat pesan baru untukmu âœ¨"});try{const a=await r.post(route("daily.regenerate",{space:C,id:e.id})),s=a.data?.success??"Pesan berhasil di-regenerate! ðŸŽ‰";B({type:"success",message:s}),c.reload({only:["messages"]})}catch(s){let e="Gagal regenerate pesan. Coba lagi nanti, ya.";r.isAxiosError(s)&&"string"==typeof s.response?.data?.error&&(e=s.response.data.error),B({type:"error",message:e})}finally{P(null),z(null)}})(d)},className:"flex items-center gap-1.5 px-3 py-1 text-sm rounded-lg bg-purple-500 text-white transition hover:bg-purple-600 "+(A===String(d.id)?"opacity-70 cursor-not-allowed":""),disabled:A===String(d.id),title:"Regenerate message with AI",children:[s.jsx(y,{className:"h-3.5 w-3.5"}),"Regenerate"]}),s.jsx("button",{type:"button",onClick:()=>{(async e=>{if(null!==A)return;const a=String(e.id);z(a),P({title:N.feedback?.email_sending??"Mengirim daily message ke email pasangan...",description:"Tunggu sebentar, kami sedang mengirim pesan manisnya kepada pasanganmu."});try{const a=await r.post(route("daily.email",{space:C,id:e.id})),s=a.data?.message??N.feedback?.email_sent??"Daily message berhasil dikirim ke email pasangan!";B({type:"success",message:s})}catch(s){let e=N.feedback?.email_failed??"Gagal mengirim email. Coba lagi nanti, ya.";if(r.isAxiosError(s)){const a=N.feedback?.email_partner_missing??"Hubungkan pasanganmu dan pastikan alamat email tersedia sebelum mengirim.";422===s.response?.status?e=s.response.data?.error??a:"string"==typeof s.response?.data?.error&&(e=s.response.data.error)}B({type:"error",message:e})}finally{P(null),z(null)}})(d)},className:"px-3 py-1 text-sm rounded-lg bg-blue-500 text-white transition hover:bg-blue-600 "+(A===String(d.id)?"opacity-70 cursor-not-allowed":""),disabled:A===String(d.id),children:N.actions?.send_email??S("actions.send_email","Send to Email")})]}));var m})}),s.jsx(m,{show:I,onClose:()=>M(!1),children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),c.get(route("daily.index",{space:C}),{search:T,date:_},{preserveState:!0,replace:!0,onSuccess:()=>M(!1)})},className:"p-6",children:[s.jsx("h2",{className:"text-lg font-medium text-gray-900",children:N.modal?.title??"Cari Pesan Harian"}),s.jsxs("div",{className:"mt-6",children:[s.jsx(x,{htmlFor:"searchKeyword",value:N.modal?.keyword??"Kata Kunci"}),s.jsx(u,{id:"searchKeyword",type:"text",className:"mt-1 block w-full",value:T,onChange:e=>L(e.target.value)})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx(x,{htmlFor:"searchDate",value:N.modal?.date??"Tanggal (YYYY-MM-DD)"}),s.jsx(u,{id:"searchDate",type:"date",className:"mt-1 block w-full",value:_,onChange:e=>D(e.target.value)})]}),s.jsxs("div",{className:"mt-6 flex justify-end",children:[s.jsx(g,{onClick:()=>{L(""),D(""),c.get(route("daily.index",{space:C}),{},{preserveState:!0,replace:!0,onSuccess:()=>M(!1)})},children:S("actions.clear","Clear")}),s.jsx(p,{className:"ms-3",type:"submit",children:N.actions?.search??"Cari"})]})]})}),R&&s.jsx("div",{className:"fixed inset-x-0 top-6 z-40 flex justify-center px-4",children:s.jsxs("div",{className:"flex items-center gap-3 rounded-full px-5 py-3 text-sm font-medium text-white shadow-lg "+("success"===R.type?"bg-emerald-500":"bg-rose-500"),children:[s.jsx("span",{children:R.message}),s.jsx("button",{type:"button",onClick:()=>{H.current&&(window.clearTimeout(H.current),H.current=null),B(null)},className:"rounded-full bg-white/20 p-1 text-white transition hover:bg-white/30","aria-label":"Tutup notifikasi",children:s.jsx(f,{className:"h-3.5 w-3.5"})})]})}),E&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4",children:s.jsxs("div",{className:"flex w-full max-w-sm flex-col items-center gap-3 rounded-3xl bg-white px-6 py-6 text-center shadow-2xl",children:[s.jsx(b,{className:"h-8 w-8 animate-spin text-pink-500"}),s.jsx("h3",{className:"text-base font-semibold text-slate-900",children:E.title}),E.description&&s.jsx("p",{className:"text-sm text-slate-500",children:E.description})]})})]})]})}export{w as default};
