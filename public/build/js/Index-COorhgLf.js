import{r as e,j as a,S as s,x as t,A as r}from"./react-core-DkDn4djD.js";import{u as n,a as i}from"./games-DLF3M88Y.js";import{aK as l,aL as o,ag as c}from"./vendor-D-GzWRLi.js";import{u as d}from"./animation-Dcgp7Est.js";import{M as m}from"./Modal-BE2R3cny.js";import{T as u}from"./TextInput-f5Z7GFl-.js";import{I as x}from"./InputLabel-noL9HGU3.js";import{P as p}from"./PrimaryButton-kcDWg3Y2.js";import{S as g}from"./SecondaryButton-xbYUEvnT.js";import{u as h}from"./useCurrentSpace-B-ijKysZ.js";import{S as y,X as f,L as b}from"./ui-libs--z-UAavT.js";import"./inertia-BBHw8PYu.js";import"./maps-CVSyMViq.js";const j=({text:s,wordLimit:t,expandMoreLabel:r,expandLessLabel:n})=>{const[i,l]=e.useState(!1),o=s.split(" "),c=o.length>t,d=i?s:o.slice(0,t).join(" ")+(c?"...":"");return a.jsxs("div",{children:[a.jsx("p",{className:"mt-2 text-gray-700 text-justify "+(i?"":"max-h-24 overflow-hidden"),dangerouslySetInnerHTML:{__html:d}}),c&&a.jsx("button",{onClick:()=>l(!i),className:"text-pink-600 hover:text-pink-800 text-sm mt-2",children:i?n:r})]})};function w({messages:w,filters:v}){const N=h(),{translations:k}=n("daily_messages"),{t:S}=n("common");if(!N)return null;const C=N.slug,[L,M]=e.useState(!1),[T,I]=e.useState(v.search||""),[_,D]=e.useState(v.date||""),[A,z]=e.useState(null),[E,K]=e.useState(null),[P,R]=e.useState(null),B=e.useRef(null);e.useEffect(()=>()=>{B.current&&(window.clearTimeout(B.current),B.current=null)},[]),e.useEffect(()=>{P&&(B.current&&window.clearTimeout(B.current),B.current=window.setTimeout(()=>{R(null),B.current=null},6e3))},[P]);const H=e.useRef(null),Y=e.useRef(w.map(()=>({x:0,y:0}))).current,[F,$]=l(w.length,e=>({x:Y[e].x,y:Y[e].y,zIndex:1,config:{mass:1,tension:280,friction:60}})),G=d(({args:[e],down:a,movement:[s,t]})=>{Y[e]={x:s,y:t},$.start(r=>{if(e===r)return{x:a?s:Y[r].x,y:a?t:Y[r].y,zIndex:a?1e3:1,immediate:a}})});return a.jsxs(i,{header:a.jsx("h2",{className:"font-semibold text-xl text-gray-800",children:k.header??"Daily Message"}),children:[a.jsx(s,{title:k.meta?.title??"Daily Messages"}),a.jsxs("div",{className:"p-6 space-y-6 max-w-8xl mx-auto",children:[a.jsxs("div",{className:"p-4 flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-bold text-pink-700",children:k.title??"Pesan Harian Kita ðŸ’Œ"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>M(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-md transition duration-200",children:k.actions?.search??"Cari Pesan"}),a.jsx(t,{href:route("daily.create",{space:C}),className:"bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg shadow-md transition duration-200",children:k.actions?.add_manual??"+ Tambah Manual"})]})]}),0===w.length?a.jsx("p",{className:"text-gray-500 text-center py-8",children:k.empty??"Belum ada pesan harian. AI akan generate otomatis! âœ¨"}):a.jsx("div",{ref:H,className:"grid grid-cols-1 md:grid-cols-3 gap-6 items-start",children:F.map((s,t)=>{const{x:n,y:i,zIndex:l}=s,d=w[t];return e.createElement(o.div,{...G(t),key:d.id,style:{x:n,y:i,zIndex:l.to(e=>Math.round(e)),touchAction:"none"},className:"p-4 bg-white shadow-md rounded-xl border border-gray-100 hover:shadow-xl transition duration-200 cursor-grab active:cursor-grabbing"},a.jsx("h4",{className:"font-semibold text-gray-800",children:d.date}),a.jsx("p",{className:"text-xs text-gray-500 mb-2",children:d.user?`From: ${d.user.name}`:""}),a.jsx(j,{text:(m=`"${d.message}"`,m.replace(/<[^>]*>/g,"").replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/\*(.*?)\*/g,"<strong>$1</strong>")),wordLimit:50,expandMoreLabel:k.expand?.more??"Baca selengkapnya",expandLessLabel:k.expand?.less??"Baca lebih sedikit"}),a.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[a.jsxs("button",{type:"button",onClick:()=>{(async e=>{if(null!==A)return;const a=String(e.id);z(a),K({title:"Regenerating message with AI...",description:"Tunggu sebentar, kami sedang membuat pesan baru untukmu âœ¨"});try{const a=await c.post(route("daily.regenerate",{space:C,id:e.id})),s=a.data?.success??"Pesan berhasil di-regenerate! ðŸŽ‰";R({type:"success",message:s}),r.reload({only:["messages"]})}catch(s){let e="Gagal regenerate pesan. Coba lagi nanti, ya.";c.isAxiosError(s)&&"string"==typeof s.response?.data?.error&&(e=s.response.data.error),R({type:"error",message:e})}finally{K(null),z(null)}})(d)},className:"flex items-center gap-1.5 px-3 py-1 text-sm rounded-lg bg-purple-500 text-white transition hover:bg-purple-600 "+(A===String(d.id)?"opacity-70 cursor-not-allowed":""),disabled:A===String(d.id),title:"Regenerate message with AI",children:[a.jsx(y,{className:"h-3.5 w-3.5"}),"Regenerate"]}),a.jsx("button",{type:"button",onClick:()=>{(async e=>{if(null!==A)return;const a=String(e.id);z(a),K({title:k.feedback?.email_sending??"Mengirim daily message ke email pasangan...",description:"Tunggu sebentar, kami sedang mengirim pesan manisnya kepada pasanganmu."});try{const a=await c.post(route("daily.email",{space:C,id:e.id})),s=a.data?.message??k.feedback?.email_sent??"Daily message berhasil dikirim ke email pasangan!";R({type:"success",message:s})}catch(s){let e=k.feedback?.email_failed??"Gagal mengirim email. Coba lagi nanti, ya.";if(c.isAxiosError(s)){const a=k.feedback?.email_partner_missing??"Hubungkan pasanganmu dan pastikan alamat email tersedia sebelum mengirim.";422===s.response?.status?e=s.response.data?.error??a:"string"==typeof s.response?.data?.error&&(e=s.response.data.error)}R({type:"error",message:e})}finally{K(null),z(null)}})(d)},className:"px-3 py-1 text-sm rounded-lg bg-blue-500 text-white transition hover:bg-blue-600 "+(A===String(d.id)?"opacity-70 cursor-not-allowed":""),disabled:A===String(d.id),children:k.actions?.send_email??S("actions.send_email","Send to Email")})]}));var m})}),a.jsx(m,{show:L,onClose:()=>M(!1),children:a.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.get(route("daily.index",{space:C}),{search:T,date:_},{preserveState:!0,replace:!0,onSuccess:()=>M(!1)})},className:"p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:k.modal?.title??"Cari Pesan Harian"}),a.jsxs("div",{className:"mt-6",children:[a.jsx(x,{htmlFor:"searchKeyword",value:k.modal?.keyword??"Kata Kunci"}),a.jsx(u,{id:"searchKeyword",type:"text",className:"mt-1 block w-full",value:T,onChange:e=>I(e.target.value)})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx(x,{htmlFor:"searchDate",value:k.modal?.date??"Tanggal (YYYY-MM-DD)"}),a.jsx(u,{id:"searchDate",type:"date",className:"mt-1 block w-full",value:_,onChange:e=>D(e.target.value)})]}),a.jsxs("div",{className:"mt-6 flex justify-end",children:[a.jsx(g,{onClick:()=>{I(""),D(""),r.get(route("daily.index",{space:C}),{},{preserveState:!0,replace:!0,onSuccess:()=>M(!1)})},children:S("actions.clear","Clear")}),a.jsx(p,{className:"ms-3",type:"submit",children:k.actions?.search??"Cari"})]})]})}),P&&a.jsx("div",{className:"fixed inset-x-0 top-6 z-40 flex justify-center px-4",children:a.jsxs("div",{className:"flex items-center gap-3 rounded-full px-5 py-3 text-sm font-medium text-white shadow-lg "+("success"===P.type?"bg-emerald-500":"bg-rose-500"),children:[a.jsx("span",{children:P.message}),a.jsx("button",{type:"button",onClick:()=>{B.current&&(window.clearTimeout(B.current),B.current=null),R(null)},className:"rounded-full bg-white/20 p-1 text-white transition hover:bg-white/30","aria-label":"Tutup notifikasi",children:a.jsx(f,{className:"h-3.5 w-3.5"})})]})}),E&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4",children:a.jsxs("div",{className:"flex w-full max-w-sm flex-col items-center gap-3 rounded-3xl bg-white px-6 py-6 text-center shadow-2xl",children:[a.jsx(b,{className:"h-8 w-8 animate-spin text-pink-500"}),a.jsx("h3",{className:"text-base font-semibold text-slate-900",children:E.title}),E.description&&a.jsx("p",{className:"text-sm text-slate-500",children:E.description})]})})]})]})}export{w as default};
