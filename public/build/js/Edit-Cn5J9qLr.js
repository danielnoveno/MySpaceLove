import{r as e,j as t}from"./vendor-DXr22Lef.js";import{a as r,u as i,b as a}from"./games-RZpJ1ixc.js";import{G as s,S as o,x as n,A as l}from"./inertia-2axaVlnj.js";import{D as d,C as c,P as m}from"./dnd-C-isQV9R.js";import{u}from"./useCurrentSpace-CdnheA8Y.js";import{c as p}from"./imageConverter-BDj124y7.js";import{e as x,X as h,U as b,A as g}from"./ui-libs-D5k9l7B7.js";import"./animation-H0tefZHq.js";function f({item:f}){const v=u(),{showSuccess:y,showError:j}=r(),{t:w}=i("errors"),{translations:k}=i("timeline"),N=w("timeline.image_too_large","File size too large. Maximum 10 MB for memory and special moment photos."),C=w("timeline.max_media_count","You can upload up to :count photos at once.").replace(":count",String(5)),R=w("upload.image_not_convertible","The image could not be processed into .webp format."),S=k?.edit?.heading??{},U=k?.create?.form??{},_=U.actions?.cancel??"Cancel",E=S.submit??U.actions?.submit??"Save memory",L=S.submitting??U.actions?.submitting??"Saving…",z=S.media_label??U.media?.label??"Photos",D=S.media_button??U.media?.button??"Choose photos",M=U.media?.helper?.replace(":count",String(5))??"Upload up to 5 photos.";if(!v)return null;const T=v.slug,O=v.title,P=k?.meta?.edit??"Edit Memory",{data:$,setData:A,post:F,processing:I,errors:H}=s({title:f.title??"",description:f.description??"",date:f.date,media:[],media_keys:[],removed:[],ordered:f.media_paths||[]}),Y=(f.media_paths??[]).map(e=>({kind:"existing",path:e,url:`/storage/${e}`})),[W,X]=e.useState(Y),q=e.useRef([]),[B,G]=e.useState(null),[J,K]=e.useState(null);e.useEffect(()=>()=>{q.current.forEach(e=>URL.revokeObjectURL(e)),q.current=[]},[]);const Q=e.useRef(null),[V,Z]=e.useState({x:0,y:0});return e.useEffect(()=>{const e=Q.current;if(!e)return;const t=e.getContext("2d");if(!t)return;e.width=window.innerWidth,e.height=window.innerHeight;const r=[],i=()=>{t.clearRect(0,0,e.width,e.height),r.forEach((i,a)=>{i.x+=i.dx,i.y+=i.dy,((e,r,i,a=.6)=>{t.save(),t.translate(e,r),t.scale(i/20,i/20),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(0,-3,-5,-15,-20,-15),t.bezierCurveTo(-55,-15,-55,22.5,-55,22.5),t.bezierCurveTo(-55,40,-35,62,0,80),t.bezierCurveTo(35,62,55,40,55,22.5),t.bezierCurveTo(55,22.5,55,-15,20,-15),t.bezierCurveTo(5,-15,0,-3,0,0),t.fillStyle=`rgba(244,63,94,${a})`,t.fill(),t.restore()})(i.x,i.y,i.s),(i.x<0||i.y<0||i.x>e.width||i.y>e.height)&&r.splice(a,1)}),requestAnimationFrame(i)};i();const a=e=>{for(let a=0;a<2;a++)r.push({x:e.clientX,y:e.clientY,s:8*Math.random()+10,dx:2*(Math.random()-.5),dy:2*(Math.random()-.5)});const t=window.innerWidth/2,i=window.innerHeight/2;Z({x:.02*(e.clientX-t),y:.02*(e.clientY-i)})};return window.addEventListener("mousemove",a),()=>window.removeEventListener("mousemove",a)},[]),e.useEffect(()=>{A(e=>({...e,ordered:W.map(e=>"existing"===e.kind?e.path:e.id)}))},[W,A]),t.jsxs(a,{header:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(n,{href:route("timeline.index",{space:T}),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:t.jsx(g,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:S.title??"Edit Memory"}),t.jsx("p",{className:"text-gray-600",children:S.subtitle?.replace(":space",O)??`Refresh the details for ${O}.`})]})]}),children:[t.jsx(o,{title:P}),t.jsxs("div",{className:"relative min-h-screen bg-gradient-to-br from-pink-50 via-white to-rose-50 py-10 px-4 sm:px-6 lg:px-8 overflow-hidden",children:[t.jsx("canvas",{ref:Q,className:"absolute inset-0 w-full h-full pointer-events-none"}),t.jsx("div",{className:"relative max-w-4xl mx-auto",children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),F(route("timeline.update",{space:T,timeline:f.uuid}),{forceFormData:!0,onSuccess:()=>{y("Momen berhasil diperbarui!"),l.visit(route("timeline.index",{space:T}))},onError:e=>{j("Gagal memperbarui momen. Silakan periksa kembali input Anda.")}})},className:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg border border-gray-100 p-8 md:p-10 relative z-10 space-y-8",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:U.title?.label??"Moment Title"}),t.jsx("input",{type:"text",value:$.title,onChange:e=>A("title",e.target.value),className:"w-full px-5 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-pink-500",placeholder:U.title?.placeholder??"e.g. Our first anniversary dinner"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:U.date?.label??"Date"}),t.jsxs("div",{className:"relative",children:[t.jsx(x,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"date",value:$.date,onChange:e=>A("date",e.target.value),className:"w-full pl-12 pr-5 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-pink-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:U.description?.label??"Description"}),t.jsx("textarea",{value:$.description,onChange:e=>A("description",e.target.value),rows:5,className:"w-full px-5 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-pink-500",placeholder:U.description?.placeholder??"Tell the story behind this moment…"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-3",children:z}),t.jsx(d,{onDragEnd:e=>{if(!e.destination)return;const t=e.destination.index;X(r=>{const i=Array.from(r),[a]=i.splice(e.source.index,1);return a?(i.splice(t,0,a),i):r})},children:t.jsx(c,{droppableId:"images",direction:"horizontal",children:e=>t.jsxs("div",{className:"flex gap-4 overflow-x-auto pb-2",...e.droppableProps,ref:e.innerRef,children:[W.map((e,r)=>{const i="existing"===e.kind?`existing-${e.path}`:`new-${e.id}`;return t.jsx(m,{draggableId:i,index:r,children:i=>t.jsxs("div",{ref:i.innerRef,...i.draggableProps,...i.dragHandleProps,className:"group relative flex-shrink-0",children:[t.jsx("img",{src:e.url,className:"h-32 w-40 cursor-move rounded-xl object-cover shadow",onClick:()=>K(e.url)}),t.jsx("button",{type:"button",onClick:()=>(e=>{const t=W[e];t&&(X(t=>t.filter((t,r)=>r!==e)),"existing"===t.kind?A(e=>({...e,removed:e.removed.includes(t.path)?e.removed:[...e.removed,t.path]})):(URL.revokeObjectURL(t.url),q.current=q.current.filter(e=>e!==t.url),A(e=>{const r=e.media_keys.indexOf(t.id);if(-1===r)return e;const i=[...e.media],a=[...e.media_keys];return i.splice(r,1),a.splice(r,1),{...e,media:i,media_keys:a}})))})(r),className:"absolute right-2 top-2 rounded-full bg-black/50 p-1 text-white opacity-0 transition group-hover:opacity-100",children:t.jsx(h,{className:"h-4 w-4"})})]})},i)}),e.placeholder]})})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:z}),t.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center hover:border-pink-400 transition",children:[t.jsx(b,{className:"w-14 h-14 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:M}),t.jsx("input",{type:"file",multiple:!0,onChange:e=>{(async e=>{const t=Array.from(e.target.files||[]);if(0===t.length)return;if(W.length+t.length>5)return void G(C);const r=[],i=[],a=[];for(const o of t)try{const e=await p(o);if(e.size>10485760)return G(N),void a.forEach(e=>URL.revokeObjectURL(e));const t="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`new-${Date.now()}-${Math.random().toString(16).slice(2,10)}`,s=URL.createObjectURL(e);q.current.push(s),a.push(s),i.push(e),r.push({kind:"new",id:t,file:e,url:s})}catch(s){return G(R),void a.forEach(e=>URL.revokeObjectURL(e))}G(null),X(e=>[...e,...r]),A(e=>({...e,media:[...e.media,...i],media_keys:[...e.media_keys,...r.map(e=>e.id)]}))})(e)},accept:"image/*",className:"hidden",id:"media-upload"}),t.jsx("label",{htmlFor:"media-upload",className:"cursor-pointer bg-pink-500 text-white px-8 py-3 rounded-xl font-medium hover:bg-pink-600 transition",children:D}),B&&t.jsx("p",{className:"text-red-500 text-sm mt-3",children:B})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[t.jsx(n,{href:route("timeline.index",{space:T}),className:"flex-1 px-6 py-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 text-center",children:_}),t.jsx("button",{type:"submit",disabled:I,className:"flex-1 bg-gradient-to-r from-pink-500 to-rose-500 text-white px-6 py-4 rounded-xl font-semibold hover:shadow-lg disabled:opacity-50",children:I?L:E})]})]})}),J&&t.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>K(null),children:t.jsx("img",{src:J,alt:"Preview",className:"max-h-[90vh] max-w-[90vw] object-contain rounded-lg"})})]})]})}export{f as default};
