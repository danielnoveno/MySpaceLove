import{r as e,al as t,j as a,aL as s,aM as n,aN as l,aO as i,aP as r,aQ as o,aR as d}from"./vendor-DXr22Lef.js";import{b as c}from"./games-RZpJ1ixc.js";import{S as u}from"./inertia-2axaVlnj.js";import{u as p,v as m,w as x,O as g}from"./ui-libs-D5k9l7B7.js";import"./animation-H0tefZHq.js";const h=[-2.5489,118.0149],b=({primaryColor:e,iconColor:t})=>i.divIcon({className:"custom-leaflet-marker",html:`\n            <div style="\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 6px;\n            ">\n                <span style="\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    width: 44px;\n                    height: 44px;\n                    border-radius: 9999px;\n                    background: #ffffff;\n                    border: 4px solid ${e};\n                    box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);\n                ">\n                    <svg\n                        xmlns="http://www.w3.org/2000/svg"\n                        viewBox="0 0 24 24"\n                        width="22"\n                        height="22"\n                        fill="none"\n                        stroke="${t}"\n                        stroke-width="1.8"\n                        stroke-linecap="round"\n                        stroke-linejoin="round"\n                    >\n                        <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/>\n                        <circle cx="12" cy="10" r="3"/>\n                    </svg>\n                </span>\n                <span style="\n                    width: 10px;\n                    height: 10px;\n                    border-radius: 9999px;\n                    background: ${e};\n                    opacity: 0.85;\n                    box-shadow: 0 3px 10px rgba(15, 23, 42, 0.25);\n                "></span>\n            </div>\n        `,iconSize:[46,60],iconAnchor:[23,56],tooltipAnchor:[0,-48],popupAnchor:[0,-48]}),y=b({primaryColor:"#ec4899",iconColor:"#db2777"}),f=b({primaryColor:"#8b5cf6",iconColor:"#7c3aed"});function w({center:t}){const a=d();return e.useEffect(()=>{a.setView(t)},[t,a]),null}function k(e,t,a,s){const n=e=>e*Math.PI/180,l=n(a-e),i=n(s-t),r=Math.sin(l/2)*Math.sin(l/2)+Math.cos(n(e))*Math.cos(n(a))*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371}function j(e){if(!e)return null;try{return new Intl.DateTimeFormat("id-ID",{dateStyle:"medium",timeStyle:"short"}).format(new Date(e))}catch(t){return null}}function N({auth:i,partner:d,userLocation:b,partnerLocation:N,shareBaseUrl:v,pendingInvitation:C,space:S}){const[M,$]=e.useState(b),[F,P]=e.useState(N),[L,E]=e.useState(b?.updated_at??null),[T,I]=e.useState(N?.updated_at??null),[B,R]=e.useState(!1),[_,A]=e.useState(!1),[O,K]=e.useState(!1),[U,q]=e.useState(!1),[z,D]=e.useState(null),Y=e.useMemo(()=>{if("undefined"==typeof window)return v;try{const e=new URL(v);return e.protocol=window.location.protocol,e.host=window.location.host,e.toString()}catch(e){return`${window.location.origin}/location/${S.slug}`}},[v,S.slug]),[H,J]=e.useState(!1),[X,Q]=e.useState(null),[V,W]=e.useState(d),Z=Boolean(V?.email),[G,ee]=e.useState(!1),[te,ae]=e.useState(!1),[se,ne]=e.useState(""),[le,ie]=e.useState(""),[re,oe]=e.useState(C),[de,ce]=e.useState(C?.email??null),[ue,pe]=e.useState(null),[me,xe]=e.useState(null);e.useEffect(()=>{oe(C),ce(C?.email??null)},[C]);const[ge,he]=e.useState(!1),[be,ye]=e.useState(null),[fe,we]=e.useState(null),ke=e.useRef(),je=e.useRef(null),Ne=e.useRef(null);e.useEffect(()=>(R(!0),()=>{ke.current&&window.clearTimeout(ke.current)}),[]),e.useEffect(()=>{B&&M&&je.current&&je.current.openPopup()},[B,M]),e.useEffect(()=>{B&&V&&F&&Ne.current&&Ne.current.openPopup()},[B,V,F]);const ve=e.useCallback((e,t)=>{Q({message:e,type:t}),ke.current&&window.clearTimeout(ke.current),ke.current=window.setTimeout(()=>{Q(null)},4e3)},[]),Ce=e.useCallback(async(e=!1)=>{if(V)try{const a=await t.get(`/api/location/${V.id}`),s=a.data.location?{latitude:a.data.location.latitude,longitude:a.data.location.longitude,updated_at:a.data.location.updated_at}:null;P(s),I(s?.updated_at??null),!e&&s&&ve("Lokasi pasangan diperbarui ðŸ’•","success")}catch(a){e||ve("Failed to fetch partner location.","error")}},[V,ve]),Se=e.useCallback(async e=>{e.preventDefault(),pe(null),ee(!0);try{const e=se.trim(),a=le.trim();if(!e||!a)return void ve("Nama dan email pasangan wajib diisi.","error");const s=(await t.post(`/api/spaces/${S.slug}/connect-partner`,{partner_name:e,partner_email:a})).data,n=s.invitation??null;oe(n),ce(n?.email??s.partner_account?.email??a),pe(s.temporary_password??null),ve("Invitation sent successfully. Ask your partner to confirm.","success"),ae(!1),ne(""),ie("")}catch(a){let e="Failed to connect partner.";if(t.isAxiosError(a)){const t=a.response?.data,s=t?.errors?Object.values(t.errors).flat().find(e=>"string"==typeof e):void 0;s?e=s:"string"==typeof t?.message&&""!==t.message.trim()&&(e=t.message)}ve(e,"error")}finally{ee(!1)}},[le,se,ve,S.slug]),Me=e.useCallback(async(e,a,s)=>{try{const n=(await t.post("/api/location/update",{latitude:e,longitude:a})).data.location;$(n),E(n.updated_at??null),s||ve("Your location updated successfully ðŸ’–","success"),await Ce(!0)}catch(n){s||ve("Failed to update location.","error")}finally{s||A(!1)}},[Ce,ve]),$e=e.useCallback(async e=>{try{const t=await fetch("https://ipapi.co/json/"),a=await t.json();if(!a?.latitude||!a?.longitude)throw new Error("IP geolocation did not return coordinates");await Me(Number(a.latitude),Number(a.longitude),e),e||ve("Menggunakan lokasi berdasarkan alamat IP.","warning")}catch(t){e||ve("Tidak dapat mengambil lokasi otomatis.","error"),e||A(!1)}},[Me,ve]),Fe=e.useCallback((e={})=>{const t=e.silent??!1;t||A(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{Me(e.coords.latitude,e.coords.longitude,t)},()=>{$e(t)},{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}):$e(t)},[$e,Me]),Pe=e.useCallback(()=>{const e=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return e?decodeURIComponent(e[1]):null},[]),Le=e.useCallback(async()=>{Pe()||await t.get("/sanctum/csrf-cookie",{withCredentials:!0});const e=Pe();e&&(t.defaults.headers.common["X-XSRF-TOKEN"]=e)},[Pe]);e.useEffect(()=>{if(!B)return;(async()=>{await Le(),Fe({silent:!0}),Ce(!0)})();const e=window.setInterval(()=>{Fe({silent:!0}),Ce(!0)},3e4);return()=>{window.clearInterval(e)}},[Le,Ce,B,Fe]);const Ee=e.useMemo(()=>M?[M.latitude,M.longitude]:F?[F.latitude,F.longitude]:h,[F,M]),Te=e.useMemo(()=>M&&F?k(M.latitude,M.longitude,F.latitude,F.longitude):null,[F,M]),Ie=e.useMemo(()=>null!==fe?fe:Te,[fe,Te]),Be=e.useMemo(()=>j(L),[L]),Re=e.useMemo(()=>j(T),[T]),_e=e.useCallback(async(e,t)=>{he(!0),ye(null);try{const a=await fetch(`https://router.project-osrm.org/route/v1/driving/${e.longitude},${e.latitude};${t.longitude},${t.latitude}?overview=full&geometries=geojson`);if(!a.ok)throw new Error(`OSRM request failed with status ${a.status}`);const s=await a.json(),n=s.routes?.[0],l=n?.geometry?.coordinates;if(l&&Array.isArray(l)&&l.length>0){const a=l.map(([e,t])=>[t,e]);xe(a),we("number"==typeof n?.distance?n.distance/1e3:k(e.latitude,e.longitude,t.latitude,t.longitude))}else xe([[e.latitude,e.longitude],[t.latitude,t.longitude]]),we(k(e.latitude,e.longitude,t.latitude,t.longitude)),ye("Rute jalan tidak tersedia, menampilkan garis lurus.")}catch(a){xe([[e.latitude,e.longitude],[t.latitude,t.longitude]]),we(k(e.latitude,e.longitude,t.latitude,t.longitude)),ye("Failed to load road route, showing straight line.")}finally{he(!1)}},[]);e.useEffect(()=>{if(B)return M&&F?void _e(M,F):(xe(null),we(null),void ye(null))},[_e,B,F,M]);const Ae=e.useCallback(()=>{if(!M)return void ve("Lokasi belum tersedia. Tekan update lokasi terlebih dahulu.","warning");V||ve("Partner not connected on MySpaceLove yet. You can still copy the location link.","warning");const e=`${Y}?lat=${M.latitude}&lng=${M.longitude}`;D(e),q(!0)},[V,Y,ve,M]),Oe=e.useCallback(()=>{q(!1),D(null)},[]),Ke=e.useCallback(async()=>{if(M&&z){K(!0);try{await t.post("/api/location/update",{latitude:M.latitude,longitude:M.longitude});let s=!1;if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(z),s=!0}catch(e){}if(!s)try{const e=document.createElement("textarea");e.value=z,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select(),s=document.execCommand("copy"),document.body.removeChild(e)}catch(a){}s?(ve("Link lokasi tersalin ke clipboard!","success"),Oe()):ve("Tidak bisa menyalin otomatis. Salin link secara manual dari kotak di atas.","warning")}catch(s){ve("Failed to copy location link.","error")}finally{K(!1)}}else Oe()},[Oe,z,ve,M]),Ue=e.useCallback(async()=>{if(M&&z)if(V?.email){K(!0);try{await t.post(`/api/spaces/${S.slug}/location/share`,{latitude:M.latitude,longitude:M.longitude,url:z}),ve("Location link sent to partner's email successfully.","success"),Oe()}catch(e){ve("Failed to send location email.","error")}finally{K(!1)}}else ve("Tidak ada email pasangan yang terhubung. Salin link lokasi sebagai gantinya.","warning");else Oe()},[Oe,V?.email,z,ve,S.slug,M]),qe=e.useCallback(async()=>{J(!0);try{await t.delete("/api/location"),$(null),E(null),ve("Stopped sharing location.","warning")}catch(e){ve("Failed to stop location sharing.","error")}finally{J(!1)}},[ve]);return a.jsxs(c,{header:a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Berbagi Lokasi Pasangan ðŸ’ž"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Lihat posisi kalian berdua secara real-time."})]}),children:[a.jsx(u,{title:"Berbagi Lokasi"}),a.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 space-y-6",children:[a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm border border-pink-100",children:[a.jsxs("h3",{className:"mb-1 flex items-center gap-2 font-semibold text-gray-800",children:[a.jsx(p,{className:"h-4 w-4 text-pink-500"}),"You are here"]}),a.jsx("p",{className:"text-sm text-gray-600",children:M?`${M.latitude.toFixed(5)}, ${M.longitude.toFixed(5)}`:"No location yet"}),a.jsx("p",{className:"text-xs text-gray-400 mt-2",children:Be?`Terakhir diperbarui: ${Be}`:"Belum pernah diperbarui"})]}),a.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm border border-violet-100",children:[a.jsxs("h3",{className:"mb-1 flex items-center gap-2 font-semibold text-gray-800",children:[a.jsx(p,{className:"h-4 w-4 text-purple-500"}),"Pasanganmu"]}),V?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm text-gray-600",children:F?`${F.latitude.toFixed(5)}, ${F.longitude.toFixed(5)}`:"No location yet"}),a.jsx("p",{className:"text-xs text-gray-400 mt-2",children:Re?`Terakhir diperbarui: ${Re}`:"Menunggu pasangan update lokasi"})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Kirim undangan ke pasanganmu untuk mulai berbagi."}),re&&a.jsxs("div",{className:"rounded-lg border border-violet-200 bg-violet-50 px-3 py-2 text-xs text-violet-700",children:["Menunggu konfirmasi dari"," ",a.jsx("span",{className:"font-semibold",children:re.email}),". Mintalah pasanganmu untuk login dan menerima undangan yang sudah kamu kirim."]}),te?a.jsxs("form",{className:"space-y-3 rounded-xl border border-violet-100 bg-violet-50 p-3",onSubmit:Se,children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Nama Pasangan"}),a.jsx("input",{value:se,onChange:e=>ne(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500",placeholder:"Misal: Hana"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Email Pasangan"}),a.jsx("input",{type:"email",value:le,onChange:e=>ie(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500",placeholder:"pasangan@email.com"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"submit",disabled:G,className:"inline-flex items-center justify-center rounded-full bg-purple-500 px-4 py-2 text-sm font-medium text-white shadow transition hover:bg-purple-600 disabled:cursor-not-allowed disabled:bg-purple-300",children:G?"Mengirim...":"Kirim Undangan"}),a.jsx("button",{type:"button",onClick:()=>{ae(!1),ne(""),ie("")},className:"inline-flex items-center justify-center rounded-full bg-white px-4 py-2 text-sm font-medium text-gray-600 shadow-sm transition hover:bg-gray-50",children:"Batal"})]})]}):a.jsx("button",{type:"button",onClick:()=>ae(!0),className:"inline-flex items-center gap-2 rounded-full bg-purple-100 px-4 py-2 text-sm font-medium text-purple-600 transition hover:bg-purple-200",children:"Kirim Undangan ke Pasangan"})]})]})]}),ue&&de&&a.jsxs("div",{className:"rounded-2xl border border-yellow-200 bg-yellow-50 px-4 py-3 text-sm text-yellow-800 shadow-sm",children:[a.jsx("p",{className:"font-semibold",children:"Partner account created automatically."}),a.jsxs("p",{className:"mt-1",children:["Share these credentials with your partner to login:",a.jsx("br",{}),a.jsx("span",{className:"font-semibold",children:"Email:"})," ",de," ",a.jsx("span",{className:"font-semibold",children:"Password:"})," ",a.jsx("span",{className:"font-mono tracking-wide",children:ue})]})]}),null!==Ie&&a.jsx("div",{className:"rounded-2xl bg-gradient-to-r from-pink-500 to-purple-500 px-6 py-4 text-white shadow-lg",children:a.jsx("p",{className:"text-sm font-semibold",children:null!==fe?`Jarak estimasi via jalan sekitar ${Ie.toFixed(2)} km ðŸš—`:`Jarak garis lurus kalian sekitar ${Ie.toFixed(2)} km ðŸŒ`})}),a.jsxs("div",{className:"bg-white rounded-3xl shadow-lg border border-pink-100 p-4",children:[a.jsx("div",{className:"h-[420px] w-full overflow-hidden rounded-2xl",children:B?a.jsxs(s,{center:Ee,zoom:13,className:"h-full w-full",scrollWheelZoom:!0,children:[a.jsx(w,{center:Ee}),a.jsx(n,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),M&&a.jsx(l,{ref:je,position:[M.latitude,M.longitude],icon:y,children:a.jsxs(r,{autoClose:!1,closeButton:!1,closeOnClick:!1,autoPan:!1,children:[a.jsxs("span",{className:"inline-flex items-center gap-1 font-semibold text-pink-500",children:[a.jsx(p,{className:"h-4 w-4"}),"You are here"]}),a.jsx("br",{}),Be?`Last updated: ${Be}`:"No data yet"]})}),V&&F&&a.jsx(l,{ref:Ne,position:[F.latitude,F.longitude],icon:f,children:a.jsxs(r,{autoClose:!1,closeButton:!1,closeOnClick:!1,autoPan:!1,children:[a.jsxs("span",{className:"inline-flex items-center gap-1 font-semibold text-purple-500",children:[a.jsx(p,{className:"h-4 w-4"}),"Pasanganmu"]}),a.jsx("br",{}),Re?`Last updated: ${Re}`:"No data yet"]})}),me&&a.jsx(o,{positions:me,pathOptions:{color:"#ec4899",weight:5,opacity:.75,lineCap:"round",lineJoin:"round"}})]}):a.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500",children:"Memuat peta..."})}),(ge||be)&&a.jsxs("div",{className:"mt-3 px-1 space-y-1",children:[ge&&a.jsx("p",{className:"text-xs text-gray-500",children:"Menentukan jalur terbaik..."}),be&&a.jsx("p",{className:"text-xs text-yellow-600",children:be})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-3",children:[a.jsx("button",{onClick:()=>Fe({silent:!1}),disabled:_,className:"inline-flex items-center gap-2 rounded-full bg-pink-500 px-5 py-2 text-white shadow transition hover:bg-pink-600 disabled:cursor-not-allowed disabled:bg-pink-300",children:_?"Memperbarui...":a.jsxs(a.Fragment,{children:[a.jsx(m,{className:"h-4 w-4"}),"Update Lokasi"]})}),a.jsx("button",{onClick:Ae,disabled:O,className:"inline-flex items-center gap-2 rounded-full bg-purple-500 px-5 py-2 text-white shadow transition hover:bg-purple-600 disabled:cursor-not-allowed disabled:bg-purple-300",children:O?"Mengirim...":a.jsxs(a.Fragment,{children:[a.jsx(x,{className:"h-4 w-4"}),"Share Lokasi"]})}),a.jsx("button",{onClick:qe,disabled:H,className:"inline-flex items-center gap-2 rounded-full bg-gray-200 px-5 py-2 text-gray-700 shadow transition hover:bg-gray-300 disabled:cursor-not-allowed disabled:opacity-70",children:H?"Memproses...":a.jsxs(a.Fragment,{children:[a.jsx(g,{className:"h-4 w-4"}),"Stop Sharing"]})})]}),U&&a.jsx("div",{className:"mt-4 w-full max-w-md rounded-2xl border border-purple-100 bg-white p-6 shadow-md",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-purple-900",children:"Bagikan Lokasi"}),a.jsx("p",{className:"text-sm text-purple-600",children:"Pilih cara berbagi titik lokasi ini dengan pasanganmu."})]}),z&&a.jsx("p",{className:"break-words rounded-2xl bg-purple-50 px-3 py-2 text-xs text-purple-500",children:z}),a.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[a.jsx("button",{type:"button",onClick:()=>{Ke()},disabled:O,className:"rounded-2xl border border-purple-200 bg-white px-4 py-3 text-sm font-semibold text-purple-600 shadow-sm transition hover:bg-purple-50 disabled:cursor-not-allowed disabled:opacity-60",children:"Salin Link"}),a.jsx("button",{type:"button",onClick:()=>{Ue()},disabled:O||!Z,className:"rounded-2xl border border-pink-200 bg-pink-500 px-4 py-3 text-sm font-semibold text-white shadow-sm transition hover:bg-pink-600 disabled:cursor-not-allowed disabled:opacity-60",children:"Kirim Email"})]}),!Z&&a.jsx("p",{className:"text-xs text-gray-500",children:"Hubungkan pasangan dan pastikan email-nya terisi untuk mengirim email otomatis."}),a.jsx("button",{type:"button",onClick:Oe,disabled:O,className:"w-full rounded-2xl border border-gray-200 px-4 py-3 text-sm font-semibold text-gray-600 transition hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:"Tutup"})]})}),X&&a.jsx("div",{className:"fixed bottom-6 right-6 z-50 rounded-2xl px-4 py-3 text-sm shadow-lg transition "+("success"===X.type?"bg-white border border-green-200 text-green-600":"error"===X.type?"bg-white border border-red-200 text-red-600":"bg-white border border-yellow-200 text-yellow-600"),children:X.message})]})]})}export{N as default};
