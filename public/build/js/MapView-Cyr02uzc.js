import{r as e,j as t,S as a}from"./react-core-Qj66Ha7M.js";import{a as s}from"./games-CFSwBByO.js";import{ag as n}from"./vendor-CMS1sWg9.js";import{M as i,T as l,b as r,L as o,P as d,d as c,u}from"./maps-CDMlDeKs.js";import{p,q as m,r as x,O as g}from"./ui-libs-CcEHHdUW.js";import"./inertia-COacoA5b.js";import"./animation-irwqq3Ld.js";const h=[-2.5489,118.0149],b=({primaryColor:e,iconColor:t})=>o.divIcon({className:"custom-leaflet-marker",html:`\n            <div style="\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 6px;\n            ">\n                <span style="\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    width: 44px;\n                    height: 44px;\n                    border-radius: 9999px;\n                    background: #ffffff;\n                    border: 4px solid ${e};\n                    box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);\n                ">\n                    <svg\n                        xmlns="http://www.w3.org/2000/svg"\n                        viewBox="0 0 24 24"\n                        width="22"\n                        height="22"\n                        fill="none"\n                        stroke="${t}"\n                        stroke-width="1.8"\n                        stroke-linecap="round"\n                        stroke-linejoin="round"\n                    >\n                        <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/>\n                        <circle cx="12" cy="10" r="3"/>\n                    </svg>\n                </span>\n                <span style="\n                    width: 10px;\n                    height: 10px;\n                    border-radius: 9999px;\n                    background: ${e};\n                    opacity: 0.85;\n                    box-shadow: 0 3px 10px rgba(15, 23, 42, 0.25);\n                "></span>\n            </div>\n        `,iconSize:[46,60],iconAnchor:[23,56],tooltipAnchor:[0,-48],popupAnchor:[0,-48]}),f=b({primaryColor:"#ec4899",iconColor:"#db2777"}),y=b({primaryColor:"#8b5cf6",iconColor:"#7c3aed"});function w({center:t}){const a=u();return e.useEffect(()=>{a.setView(t)},[t,a]),null}function j(e,t,a,s){const n=e=>e*Math.PI/180,i=n(a-e),l=n(s-t),r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n(e))*Math.cos(n(a))*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371}function k(e){if(!e)return null;try{return new Intl.DateTimeFormat("id-ID",{dateStyle:"medium",timeStyle:"short"}).format(new Date(e))}catch(t){return null}}function N({auth:o,partner:u,userLocation:b,partnerLocation:N,shareBaseUrl:v,pendingInvitation:S,space:C}){const[M,$]=e.useState(b),[P,F]=e.useState(N),[L,E]=e.useState(b?.updated_at??null),[T,B]=e.useState(N?.updated_at??null),[I,_]=e.useState(!1),[A,q]=e.useState(!1),[O,R]=e.useState(!1),[U,z]=e.useState(!1),[D,K]=e.useState(null),Y=e.useMemo(()=>{if("undefined"==typeof window)return v;try{const e=new URL(v);return e.protocol=window.location.protocol,e.host=window.location.host,e.toString()}catch(e){return`${window.location.origin}/location/${C.slug}`}},[v,C.slug]),[H,J]=e.useState(!1),[V,W]=e.useState(null),[Z,G]=e.useState(u),Q=Boolean(Z?.email),[X,ee]=e.useState(!1),[te,ae]=e.useState(!1),[se,ne]=e.useState(""),[ie,le]=e.useState(""),[re,oe]=e.useState(S),[de,ce]=e.useState(S?.email??null),[ue,pe]=e.useState(null),[me,xe]=e.useState(null);e.useEffect(()=>{oe(S),ce(S?.email??null)},[S]);const[ge,he]=e.useState(!1),[be,fe]=e.useState(null),[ye,we]=e.useState(null),je=e.useRef(),ke=e.useRef(null),Ne=e.useRef(null);e.useEffect(()=>(_(!0),()=>{je.current&&window.clearTimeout(je.current)}),[]),e.useEffect(()=>{I&&M&&ke.current&&ke.current.openPopup()},[I,M]),e.useEffect(()=>{I&&Z&&P&&Ne.current&&Ne.current.openPopup()},[I,Z,P]);const ve=e.useCallback((e,t)=>{W({message:e,type:t}),je.current&&window.clearTimeout(je.current),je.current=window.setTimeout(()=>{W(null)},4e3)},[]),Se=e.useCallback(async(e=!1)=>{if(Z)try{const t=await n.get(`/api/location/${Z.id}`),a=t.data.location?{latitude:t.data.location.latitude,longitude:t.data.location.longitude,updated_at:t.data.location.updated_at}:null;F(a),B(a?.updated_at??null),!e&&a&&ve("Lokasi pasangan diperbarui ðŸ’•","success")}catch(t){e||ve("Failed to fetch partner location.","error")}},[Z,ve]),Ce=e.useCallback(async e=>{e.preventDefault(),pe(null),ee(!0);try{const e=se.trim(),t=ie.trim();if(!e||!t)return void ve("Nama dan email pasangan wajib diisi.","error");const a=(await n.post(`/api/spaces/${C.slug}/connect-partner`,{partner_name:e,partner_email:t})).data,s=a.invitation??null;oe(s),ce(s?.email??a.partner_account?.email??t),pe(a.temporary_password??null),ve("Invitation sent successfully. Ask your partner to confirm.","success"),ae(!1),ne(""),le("")}catch(t){let e="Failed to connect partner.";if(n.isAxiosError(t)){const a=t.response?.data,s=a?.errors?Object.values(a.errors).flat().find(e=>"string"==typeof e):void 0;s?e=s:"string"==typeof a?.message&&""!==a.message.trim()&&(e=a.message)}ve(e,"error")}finally{ee(!1)}},[ie,se,ve,C.slug]),Me=e.useCallback(async(e,t,a)=>{try{const s=(await n.post("/api/location/update",{latitude:e,longitude:t})).data.location;$(s),E(s.updated_at??null),a||ve("Your location updated successfully ðŸ’–","success"),await Se(!0)}catch(s){a||ve("Failed to update location.","error")}finally{a||q(!1)}},[Se,ve]),$e=e.useCallback(async e=>{try{const t=await fetch("https://ipapi.co/json/"),a=await t.json();if(!a?.latitude||!a?.longitude)throw new Error("IP geolocation did not return coordinates");await Me(Number(a.latitude),Number(a.longitude),e),e||ve("Menggunakan lokasi berdasarkan alamat IP.","warning")}catch(t){e||ve("Tidak dapat mengambil lokasi otomatis.","error"),e||q(!1)}},[Me,ve]),Pe=e.useCallback((e={})=>{const t=e.silent??!1;t||q(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{Me(e.coords.latitude,e.coords.longitude,t)},()=>{$e(t)},{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}):$e(t)},[$e,Me]);e.useEffect(()=>{if(!I)return;Pe({silent:!0}),Se(!0);const e=window.setInterval(()=>{Pe({silent:!0}),Se(!0)},3e4);return()=>{window.clearInterval(e)}},[Se,I,Pe]);const Fe=e.useMemo(()=>M?[M.latitude,M.longitude]:P?[P.latitude,P.longitude]:h,[P,M]),Le=e.useMemo(()=>M&&P?j(M.latitude,M.longitude,P.latitude,P.longitude):null,[P,M]),Ee=e.useMemo(()=>null!==ye?ye:Le,[ye,Le]),Te=e.useMemo(()=>k(L),[L]),Be=e.useMemo(()=>k(T),[T]),Ie=e.useCallback(async(e,t)=>{he(!0),fe(null);try{const a=await fetch(`https://router.project-osrm.org/route/v1/driving/${e.longitude},${e.latitude};${t.longitude},${t.latitude}?overview=full&geometries=geojson`);if(!a.ok)throw new Error(`OSRM request failed with status ${a.status}`);const s=await a.json(),n=s.routes?.[0],i=n?.geometry?.coordinates;if(i&&Array.isArray(i)&&i.length>0){const a=i.map(([e,t])=>[t,e]);xe(a),we("number"==typeof n?.distance?n.distance/1e3:j(e.latitude,e.longitude,t.latitude,t.longitude))}else xe([[e.latitude,e.longitude],[t.latitude,t.longitude]]),we(j(e.latitude,e.longitude,t.latitude,t.longitude)),fe("Rute jalan tidak tersedia, menampilkan garis lurus.")}catch(a){xe([[e.latitude,e.longitude],[t.latitude,t.longitude]]),we(j(e.latitude,e.longitude,t.latitude,t.longitude)),fe("Failed to load road route, showing straight line.")}finally{he(!1)}},[]);e.useEffect(()=>{if(I)return M&&P?void Ie(M,P):(xe(null),we(null),void fe(null))},[Ie,I,P,M]);const _e=e.useCallback(()=>{if(!M)return void ve("Lokasi belum tersedia. Tekan update lokasi terlebih dahulu.","warning");Z||ve("Partner not connected on MySpaceLove yet. You can still copy the location link.","warning");const e=`${Y}?lat=${M.latitude}&lng=${M.longitude}`;K(e),z(!0)},[Z,Y,ve,M]),Ae=e.useCallback(()=>{z(!1),K(null)},[]),qe=e.useCallback(async()=>{if(M&&D){R(!0);try{await n.post("/api/location/update",{latitude:M.latitude,longitude:M.longitude});let a=!1;if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(D),a=!0}catch(e){}if(!a)try{const e=document.createElement("textarea");e.value=D,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select(),a=document.execCommand("copy"),document.body.removeChild(e)}catch(t){}a?(ve("Link lokasi tersalin ke clipboard!","success"),Ae()):ve("Tidak bisa menyalin otomatis. Salin link secara manual dari kotak di atas.","warning")}catch(a){ve("Failed to copy location link.","error")}finally{R(!1)}}else Ae()},[Ae,D,ve,M]),Oe=e.useCallback(async()=>{if(M&&D)if(Z?.email){R(!0);try{await n.post(`/api/spaces/${C.slug}/location/share`,{latitude:M.latitude,longitude:M.longitude,url:D}),ve("Location link sent to partner's email successfully.","success"),Ae()}catch(e){ve("Failed to send location email.","error")}finally{R(!1)}}else ve("Tidak ada email pasangan yang terhubung. Salin link lokasi sebagai gantinya.","warning");else Ae()},[Ae,Z?.email,D,ve,C.slug,M]),Re=e.useCallback(async()=>{J(!0);try{await n.delete("/api/location"),$(null),E(null),ve("Stopped sharing location.","warning")}catch(e){ve("Failed to stop location sharing.","error")}finally{J(!1)}},[ve]);return t.jsxs(s,{header:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Berbagi Lokasi Pasangan ðŸ’ž"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Lihat posisi kalian berdua secara real-time."})]}),children:[t.jsx(a,{title:"Berbagi Lokasi"}),t.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 space-y-6",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm border border-pink-100",children:[t.jsxs("h3",{className:"mb-1 flex items-center gap-2 font-semibold text-gray-800",children:[t.jsx(p,{className:"h-4 w-4 text-pink-500"}),"You are here"]}),t.jsx("p",{className:"text-sm text-gray-600",children:M?`${M.latitude.toFixed(5)}, ${M.longitude.toFixed(5)}`:"No location yet"}),t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:Te?`Terakhir diperbarui: ${Te}`:"Belum pernah diperbarui"})]}),t.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm border border-violet-100",children:[t.jsxs("h3",{className:"mb-1 flex items-center gap-2 font-semibold text-gray-800",children:[t.jsx(p,{className:"h-4 w-4 text-purple-500"}),"Pasanganmu"]}),Z?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm text-gray-600",children:P?`${P.latitude.toFixed(5)}, ${P.longitude.toFixed(5)}`:"No location yet"}),t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:Be?`Terakhir diperbarui: ${Be}`:"Menunggu pasangan update lokasi"})]}):t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Kirim undangan ke pasanganmu untuk mulai berbagi."}),re&&t.jsxs("div",{className:"rounded-lg border border-violet-200 bg-violet-50 px-3 py-2 text-xs text-violet-700",children:["Menunggu konfirmasi dari"," ",t.jsx("span",{className:"font-semibold",children:re.email}),". Mintalah pasanganmu untuk login dan menerima undangan yang sudah kamu kirim."]}),te?t.jsxs("form",{className:"space-y-3 rounded-xl border border-violet-100 bg-violet-50 p-3",onSubmit:Ce,children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Nama Pasangan"}),t.jsx("input",{value:se,onChange:e=>ne(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500",placeholder:"Misal: Hana"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Email Pasangan"}),t.jsx("input",{type:"email",value:ie,onChange:e=>le(e.target.value),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-purple-500 focus:ring-purple-500",placeholder:"pasangan@email.com"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"submit",disabled:X,className:"inline-flex items-center justify-center rounded-full bg-purple-500 px-4 py-2 text-sm font-medium text-white shadow transition hover:bg-purple-600 disabled:cursor-not-allowed disabled:bg-purple-300",children:X?"Mengirim...":"Kirim Undangan"}),t.jsx("button",{type:"button",onClick:()=>{ae(!1),ne(""),le("")},className:"inline-flex items-center justify-center rounded-full bg-white px-4 py-2 text-sm font-medium text-gray-600 shadow-sm transition hover:bg-gray-50",children:"Batal"})]})]}):t.jsx("button",{type:"button",onClick:()=>ae(!0),className:"inline-flex items-center gap-2 rounded-full bg-purple-100 px-4 py-2 text-sm font-medium text-purple-600 transition hover:bg-purple-200",children:"Kirim Undangan ke Pasangan"})]})]})]}),ue&&de&&t.jsxs("div",{className:"rounded-2xl border border-yellow-200 bg-yellow-50 px-4 py-3 text-sm text-yellow-800 shadow-sm",children:[t.jsx("p",{className:"font-semibold",children:"Partner account created automatically."}),t.jsxs("p",{className:"mt-1",children:["Share these credentials with your partner to login:",t.jsx("br",{}),t.jsx("span",{className:"font-semibold",children:"Email:"})," ",de," ",t.jsx("span",{className:"font-semibold",children:"Password:"})," ",t.jsx("span",{className:"font-mono tracking-wide",children:ue})]})]}),null!==Ee&&t.jsx("div",{className:"rounded-2xl bg-gradient-to-r from-pink-500 to-purple-500 px-6 py-4 text-white shadow-lg",children:t.jsx("p",{className:"text-sm font-semibold",children:null!==ye?`Jarak estimasi via jalan sekitar ${Ee.toFixed(2)} km ðŸš—`:`Jarak garis lurus kalian sekitar ${Ee.toFixed(2)} km ðŸŒ`})}),t.jsxs("div",{className:"bg-white rounded-3xl shadow-lg border border-pink-100 p-4",children:[t.jsx("div",{className:"h-[420px] w-full overflow-hidden rounded-2xl",children:I?t.jsxs(i,{center:Fe,zoom:13,className:"h-full w-full",scrollWheelZoom:!0,children:[t.jsx(w,{center:Fe}),t.jsx(l,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),M&&t.jsx(r,{ref:ke,position:[M.latitude,M.longitude],icon:f,children:t.jsxs(d,{autoClose:!1,closeButton:!1,closeOnClick:!1,autoPan:!1,children:[t.jsxs("span",{className:"inline-flex items-center gap-1 font-semibold text-pink-500",children:[t.jsx(p,{className:"h-4 w-4"}),"You are here"]}),t.jsx("br",{}),Te?`Last updated: ${Te}`:"No data yet"]})}),Z&&P&&t.jsx(r,{ref:Ne,position:[P.latitude,P.longitude],icon:y,children:t.jsxs(d,{autoClose:!1,closeButton:!1,closeOnClick:!1,autoPan:!1,children:[t.jsxs("span",{className:"inline-flex items-center gap-1 font-semibold text-purple-500",children:[t.jsx(p,{className:"h-4 w-4"}),"Pasanganmu"]}),t.jsx("br",{}),Be?`Last updated: ${Be}`:"No data yet"]})}),me&&t.jsx(c,{positions:me,pathOptions:{color:"#ec4899",weight:5,opacity:.75,lineCap:"round",lineJoin:"round"}})]}):t.jsx("div",{className:"flex h-full items-center justify-center text-sm text-gray-500",children:"Memuat peta..."})}),(ge||be)&&t.jsxs("div",{className:"mt-3 px-1 space-y-1",children:[ge&&t.jsx("p",{className:"text-xs text-gray-500",children:"Menentukan jalur terbaik..."}),be&&t.jsx("p",{className:"text-xs text-yellow-600",children:be})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsx("button",{onClick:()=>Pe({silent:!1}),disabled:A,className:"inline-flex items-center gap-2 rounded-full bg-pink-500 px-5 py-2 text-white shadow transition hover:bg-pink-600 disabled:cursor-not-allowed disabled:bg-pink-300",children:A?"Memperbarui...":t.jsxs(t.Fragment,{children:[t.jsx(m,{className:"h-4 w-4"}),"Update Lokasi"]})}),t.jsx("button",{onClick:_e,disabled:O,className:"inline-flex items-center gap-2 rounded-full bg-purple-500 px-5 py-2 text-white shadow transition hover:bg-purple-600 disabled:cursor-not-allowed disabled:bg-purple-300",children:O?"Mengirim...":t.jsxs(t.Fragment,{children:[t.jsx(x,{className:"h-4 w-4"}),"Share Lokasi"]})}),t.jsx("button",{onClick:Re,disabled:H,className:"inline-flex items-center gap-2 rounded-full bg-gray-200 px-5 py-2 text-gray-700 shadow transition hover:bg-gray-300 disabled:cursor-not-allowed disabled:opacity-70",children:H?"Memproses...":t.jsxs(t.Fragment,{children:[t.jsx(g,{className:"h-4 w-4"}),"Stop Sharing"]})})]}),U&&t.jsx("div",{className:"mt-4 w-full max-w-md rounded-2xl border border-purple-100 bg-white p-6 shadow-md",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-purple-900",children:"Bagikan Lokasi"}),t.jsx("p",{className:"text-sm text-purple-600",children:"Pilih cara berbagi titik lokasi ini dengan pasanganmu."})]}),D&&t.jsx("p",{className:"break-words rounded-2xl bg-purple-50 px-3 py-2 text-xs text-purple-500",children:D}),t.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[t.jsx("button",{type:"button",onClick:()=>{qe()},disabled:O,className:"rounded-2xl border border-purple-200 bg-white px-4 py-3 text-sm font-semibold text-purple-600 shadow-sm transition hover:bg-purple-50 disabled:cursor-not-allowed disabled:opacity-60",children:"Salin Link"}),t.jsx("button",{type:"button",onClick:()=>{Oe()},disabled:O||!Q,className:"rounded-2xl border border-pink-200 bg-pink-500 px-4 py-3 text-sm font-semibold text-white shadow-sm transition hover:bg-pink-600 disabled:cursor-not-allowed disabled:opacity-60",children:"Kirim Email"})]}),!Q&&t.jsx("p",{className:"text-xs text-gray-500",children:"Hubungkan pasangan dan pastikan email-nya terisi untuk mengirim email otomatis."}),t.jsx("button",{type:"button",onClick:Ae,disabled:O,className:"w-full rounded-2xl border border-gray-200 px-4 py-3 text-sm font-semibold text-gray-600 transition hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:"Tutup"})]})}),V&&t.jsx("div",{className:"fixed bottom-6 right-6 z-50 rounded-2xl px-4 py-3 text-sm shadow-lg transition "+("success"===V.type?"bg-white border border-green-200 text-green-600":"error"===V.type?"bg-white border border-red-200 text-red-600":"bg-white border border-yellow-200 text-yellow-600"),children:V.message})]})]})}export{N as default};
