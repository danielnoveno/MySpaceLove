import{r as e,j as t}from"./vendor-DtplsvIg.js";import{u as r,a as i}from"./games-C9PD58Ia.js";import{G as s,S as a,x as o,A as n}from"./inertia-BRtPwdNN.js";import{D as l,C as d,P as c}from"./dnd-Df4HR8VY.js";import{u as m}from"./useCurrentSpace--m3qXMVy.js";import{c as u}from"./imageConverter-BDj124y7.js";import{a as p,X as x,U as h,A as b}from"./ui-libs-CxG7ASKr.js";import"./animation-BDJwZp_N.js";function g({item:g}){const f=m(),{t:v}=r("errors"),{translations:y}=r("timeline"),j=v("timeline.image_too_large","File size too large. Maximum 10 MB for memory and special moment photos."),w=v("timeline.max_media_count","You can upload up to :count photos at once.").replace(":count",String(5)),k=v("upload.image_not_convertible","The image could not be processed into .webp format."),N=y?.edit?.heading??{},C=y?.create?.form??{},R=C.actions?.cancel??"Cancel",U=N.submit??C.actions?.submit??"Save memory",_=N.submitting??C.actions?.submitting??"Saving…",S=N.media_label??C.media?.label??"Photos",E=N.media_button??C.media?.button??"Choose photos",L=C.media?.helper?.replace(":count",String(5))??"Upload up to 5 photos.";if(!f)return null;const z=f.slug,D=f.title,T=y?.meta?.edit??"Edit Memory",{data:M,setData:O,post:P,processing:$,errors:A}=s({title:g.title??"",description:g.description??"",date:g.date,media:[],media_keys:[],removed:[],ordered:g.media_paths||[]}),F=(g.media_paths??[]).map(e=>({kind:"existing",path:e,url:`/storage/${e}`})),[I,H]=e.useState(F),Y=e.useRef([]),[W,X]=e.useState(null),[q,B]=e.useState(null);e.useEffect(()=>()=>{Y.current.forEach(e=>URL.revokeObjectURL(e)),Y.current=[]},[]);const G=e.useRef(null),[J,K]=e.useState({x:0,y:0});return e.useEffect(()=>{const e=G.current;if(!e)return;const t=e.getContext("2d");if(!t)return;e.width=window.innerWidth,e.height=window.innerHeight;const r=[],i=()=>{t.clearRect(0,0,e.width,e.height),r.forEach((i,s)=>{i.x+=i.dx,i.y+=i.dy,((e,r,i,s=.6)=>{t.save(),t.translate(e,r),t.scale(i/20,i/20),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(0,-3,-5,-15,-20,-15),t.bezierCurveTo(-55,-15,-55,22.5,-55,22.5),t.bezierCurveTo(-55,40,-35,62,0,80),t.bezierCurveTo(35,62,55,40,55,22.5),t.bezierCurveTo(55,22.5,55,-15,20,-15),t.bezierCurveTo(5,-15,0,-3,0,0),t.fillStyle=`rgba(244,63,94,${s})`,t.fill(),t.restore()})(i.x,i.y,i.s),(i.x<0||i.y<0||i.x>e.width||i.y>e.height)&&r.splice(s,1)}),requestAnimationFrame(i)};i();const s=e=>{for(let s=0;s<2;s++)r.push({x:e.clientX,y:e.clientY,s:8*Math.random()+10,dx:2*(Math.random()-.5),dy:2*(Math.random()-.5)});const t=window.innerWidth/2,i=window.innerHeight/2;K({x:.02*(e.clientX-t),y:.02*(e.clientY-i)})};return window.addEventListener("mousemove",s),()=>window.removeEventListener("mousemove",s)},[]),e.useEffect(()=>{O(e=>({...e,ordered:I.map(e=>"existing"===e.kind?e.path:e.id)}))},[I,O]),t.jsxs(i,{header:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(o,{href:route("timeline.index",{space:z}),className:"p-2 hover:bg-gray-100 rounded-lg transition",children:t.jsx(b,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:N.title??"Edit Memory"}),t.jsx("p",{className:"text-gray-600",children:N.subtitle?.replace(":space",D)??`Refresh the details for ${D}.`})]})]}),children:[t.jsx(a,{title:T}),t.jsxs("div",{className:"relative min-h-screen bg-gradient-to-br from-pink-50 via-white to-rose-50 py-10 px-4 sm:px-6 lg:px-8 overflow-hidden",children:[t.jsx("canvas",{ref:G,className:"absolute inset-0 w-full h-full pointer-events-none"}),t.jsx("div",{className:"relative max-w-4xl mx-auto",children:t.jsxs("form",{onSubmit:e=>{e.preventDefault(),P(route("timeline.update",{space:z,timeline:g.uuid}),{forceFormData:!0,onSuccess:()=>n.visit(route("timeline.index",{space:z}))})},className:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg border border-gray-100 p-8 md:p-10 relative z-10 space-y-8",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:C.title?.label??"Moment Title"}),t.jsx("input",{type:"text",value:M.title,onChange:e=>O("title",e.target.value),className:"w-full px-5 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-pink-500",placeholder:C.title?.placeholder??"e.g. Our first anniversary dinner"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:C.date?.label??"Date"}),t.jsxs("div",{className:"relative",children:[t.jsx(p,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"date",value:M.date,onChange:e=>O("date",e.target.value),className:"w-full pl-12 pr-5 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-pink-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:C.description?.label??"Description"}),t.jsx("textarea",{value:M.description,onChange:e=>O("description",e.target.value),rows:5,className:"w-full px-5 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-pink-500",placeholder:C.description?.placeholder??"Tell the story behind this moment…"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-3",children:S}),t.jsx(l,{onDragEnd:e=>{if(!e.destination)return;const t=e.destination.index;H(r=>{const i=Array.from(r),[s]=i.splice(e.source.index,1);return s?(i.splice(t,0,s),i):r})},children:t.jsx(d,{droppableId:"images",direction:"horizontal",children:e=>t.jsxs("div",{className:"flex gap-4 overflow-x-auto pb-2",...e.droppableProps,ref:e.innerRef,children:[I.map((e,r)=>{const i="existing"===e.kind?`existing-${e.path}`:`new-${e.id}`;return t.jsx(c,{draggableId:i,index:r,children:i=>t.jsxs("div",{ref:i.innerRef,...i.draggableProps,...i.dragHandleProps,className:"group relative flex-shrink-0",children:[t.jsx("img",{src:e.url,className:"h-32 w-40 cursor-move rounded-xl object-cover shadow",onClick:()=>B(e.url)}),t.jsx("button",{type:"button",onClick:()=>(e=>{const t=I[e];t&&(H(t=>t.filter((t,r)=>r!==e)),"existing"===t.kind?O(e=>({...e,removed:e.removed.includes(t.path)?e.removed:[...e.removed,t.path]})):(URL.revokeObjectURL(t.url),Y.current=Y.current.filter(e=>e!==t.url),O(e=>{const r=e.media_keys.indexOf(t.id);if(-1===r)return e;const i=[...e.media],s=[...e.media_keys];return i.splice(r,1),s.splice(r,1),{...e,media:i,media_keys:s}})))})(r),className:"absolute right-2 top-2 rounded-full bg-black/50 p-1 text-white opacity-0 transition group-hover:opacity-100",children:t.jsx(x,{className:"h-4 w-4"})})]})},i)}),e.placeholder]})})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-base font-semibold text-gray-800 mb-2",children:S}),t.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center hover:border-pink-400 transition",children:[t.jsx(h,{className:"w-14 h-14 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:L}),t.jsx("input",{type:"file",multiple:!0,onChange:e=>{(async e=>{const t=Array.from(e.target.files||[]);if(0===t.length)return;if(I.length+t.length>5)return void X(w);const r=[],i=[],s=[];for(const o of t)try{const e=await u(o);if(e.size>10485760)return X(j),void s.forEach(e=>URL.revokeObjectURL(e));const t="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`new-${Date.now()}-${Math.random().toString(16).slice(2,10)}`,a=URL.createObjectURL(e);Y.current.push(a),s.push(a),i.push(e),r.push({kind:"new",id:t,file:e,url:a})}catch(a){return X(k),void s.forEach(e=>URL.revokeObjectURL(e))}X(null),H(e=>[...e,...r]),O(e=>({...e,media:[...e.media,...i],media_keys:[...e.media_keys,...r.map(e=>e.id)]}))})(e)},accept:"image/*",className:"hidden",id:"media-upload"}),t.jsx("label",{htmlFor:"media-upload",className:"cursor-pointer bg-pink-500 text-white px-8 py-3 rounded-xl font-medium hover:bg-pink-600 transition",children:E}),W&&t.jsx("p",{className:"text-red-500 text-sm mt-3",children:W})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6",children:[t.jsx(o,{href:route("timeline.index",{space:z}),className:"flex-1 px-6 py-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 text-center",children:R}),t.jsx("button",{type:"submit",disabled:$,className:"flex-1 bg-gradient-to-r from-pink-500 to-rose-500 text-white px-6 py-4 rounded-xl font-semibold hover:shadow-lg disabled:opacity-50",children:$?_:U})]})]})}),q&&t.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>B(null),children:t.jsx("img",{src:q,alt:"Preview",className:"max-h-[90vh] max-w-[90vw] object-contain rounded-lg"})})]})]})}export{g as default};
