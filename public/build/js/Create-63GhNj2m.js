import{r as e,j as s}from"./vendor-DXr22Lef.js";import{a as t,b as a}from"./games-RZpJ1ixc.js";import{u as r}from"./useCurrentSpace-CdnheA8Y.js";import{G as l,S as i,x as o}from"./inertia-2axaVlnj.js";import{U as n,d,A as c,x as m,a as x,L as u}from"./ui-libs-D5k9l7B7.js";import"./animation-H0tefZHq.js";const g=["image/jpeg","image/jpg","image/png","image/gif","video/mp4","video/quicktime"];function p(){const p=r();if(!p)return null;const h=p.slug,b=p.title,{showSuccess:f,showError:j}=t(),{data:v,setData:w,post:N,processing:y,errors:k,reset:S}=l({title:"",files:[]}),[F,M]=e.useState([]),[U,z]=e.useState(null),$=e.useRef([]),C=e.useMemo(()=>{const e=Object.entries(k).find(([e])=>e.startsWith("files."));return e?e[1]:void 0},[k]),E=async e=>new Promise((s,t)=>{if(e.type.startsWith("video/"))return void s(e);const a=new FileReader;a.onload=a=>{const r=new Image;r.onload=()=>{const a=document.createElement("canvas");a.width=r.width,a.height=r.height;const l=a.getContext("2d");l?(l.drawImage(r,0,0),a.toBlob(a=>{if(!a)return void t(new Error("Could not convert image"));const r=new File([a],e.name.replace(/\.[^/.]+$/,".webp"),{type:"image/webp"});s(r)},"image/webp",.75)):t(new Error("Could not get canvas context"))},r.onerror=()=>t(new Error("Could not load image")),r.src=a.target?.result},a.onerror=()=>t(new Error("Could not read file")),a.readAsDataURL(e)}),G=(e,s)=>{M(t=>t.map((t,a)=>a===e?{...t,...s}:t))};return s.jsxs(a,{header:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(o,{href:route("gallery.index",{space:h}),className:"rounded-lg p-2 transition hover:bg-gray-100",children:s.jsx(c,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Upload Galeri"}),s.jsxs("p",{className:"text-gray-600",children:["Tambahkan foto atau video ke galeri ",b]})]})]}),children:[s.jsx(i,{title:`Upload Galeri - ${b}`}),s.jsx("div",{className:"relative min-h-screen overflow-hidden bg-gradient-to-br from-emerald-50 via-white to-green-50 py-10 px-4 sm:px-6 lg:px-8",children:s.jsx("div",{className:"relative mx-auto max-w-3xl",children:s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),z(null);const s=F.filter(e=>"complete"===e.status).map(e=>e.file);0!==s.length?(M(e=>e.map(e=>"complete"===e.status?{...e,status:"uploading",progress:0}:e)),w("files",s),setTimeout(()=>{N(route("gallery.store",{space:h}),{forceFormData:!0,onSuccess:()=>{f("Galeri berhasil diunggah!"),$.current.forEach(e=>URL.revokeObjectURL(e)),$.current=[],M([]),S()},onError:e=>{const s=e.files?`Upload gagal: ${e.files}`:"Gagal mengunggah galeri. Silakan periksa kembali input Anda.";j(s),M(e=>e.map(e=>"uploading"===e.status?{...e,status:"complete",progress:100}:e))}})},100)):z("Tidak ada file yang berhasil diproses")},className:"relative z-10 space-y-8 rounded-3xl border border-emerald-100 bg-white/85 p-8 shadow-lg backdrop-blur-sm md:p-10",children:[s.jsxs("div",{children:[s.jsx("label",{className:"mb-2 block text-base font-semibold text-gray-800",children:"Judul Koleksi (opsional)"}),s.jsx("input",{type:"text",value:v.title,onChange:e=>w("title",e.target.value),className:"w-full rounded-2xl border border-gray-300 px-5 py-4 text-gray-800 transition focus:border-transparent focus:ring-2 focus:ring-emerald-500",placeholder:"Contoh: Foto Liburan"}),k.title&&s.jsx("p",{className:"mt-2 text-sm text-red-500",children:k.title})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("label",{className:"block text-base font-semibold text-gray-800",children:"File (Foto/Video)"}),s.jsxs("div",{className:"rounded-2xl border-2 border-dashed border-emerald-200 bg-white/80 p-8 text-center transition hover:border-emerald-400",children:[s.jsx(n,{className:"mx-auto mb-4 h-14 w-14 text-emerald-500"}),s.jsxs("p",{className:"mb-4 text-sm text-gray-600",children:["Tarik dan letakkan file di sini atau pilih manual (maks. ",12," file sekaligus)"]}),s.jsx("p",{className:"mb-4 text-xs text-emerald-500",children:"Semua file yang dipilih sekaligus akan tersimpan sebagai satu koleksi."}),s.jsx("input",{type:"file",id:"file-upload",className:"hidden",name:"files",multiple:!0,onChange:async e=>{const s=Array.from(e.target.files??[]);if(0===s.length)return;if(F.length+s.length>12)return void z("Maksimal 12 file yang dapat diunggah.");z(null);const t=s.map(e=>({file:e,originalFile:e,status:"pending",progress:0,originalSize:e.size}));M(e=>[...e,...t]);const a=F.length;for(let l=0;l<s.length;l++){const e=s[l],t=a+l;if(g.includes(e.type))try{G(t,{status:"processing",progress:30});const s=await E(e);G(t,{file:s,status:"complete",progress:100,compressedSize:s.size})}catch(r){G(t,{status:"error",error:"Gagal memproses file"})}else G(t,{status:"error",error:`Format ${e.name} tidak didukung`})}e.target.value=""},accept:"image/*,video/mp4,video/quicktime"}),s.jsx("label",{htmlFor:"file-upload",className:"inline-flex cursor-pointer items-center justify-center gap-2 rounded-xl bg-emerald-500 px-8 py-3 font-semibold text-white transition hover:bg-emerald-600",children:"Pilih File"}),F.length>0&&s.jsxs("p",{className:"mt-4 text-sm text-gray-600",children:[F.length," file dipilih"]})]}),U&&s.jsx("p",{className:"text-sm text-red-500 mt-2",children:U}),k.files&&s.jsx("p",{className:"text-sm text-red-500 mt-2",children:k.files}),C&&s.jsx("p",{className:"text-sm text-red-500 mt-2",children:"validation.uploaded"===C?"Ukuran salah satu file terlalu besar (maks. 30MB).":C})]}),s.jsxs("div",{className:"rounded-2xl border border-emerald-100 bg-white/75 p-6 shadow-sm",children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold uppercase tracking-wide text-emerald-600",children:"Preview & Status"}),F.length>0?s.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:F.map((e,t)=>{const a=URL.createObjectURL(e.originalFile),r=e.originalFile.type.startsWith("video/"),l=e=>e?e>1048576?`${(e/1048576).toFixed(2)} MB`:`${(e/1024).toFixed(1)} KB`:"â€”",i=(()=>{switch(e.status){case"pending":return{icon:s.jsx(u,{className:"h-4 w-4 text-gray-400"}),text:"Menunggu",color:"bg-gray-100 text-gray-700"};case"processing":return{icon:s.jsx(u,{className:"h-4 w-4 animate-spin text-blue-500"}),text:"Memproses",color:"bg-blue-100 text-blue-700"};case"uploading":return{icon:s.jsx(u,{className:"h-4 w-4 animate-spin text-emerald-500"}),text:"Mengunggah",color:"bg-emerald-100 text-emerald-700"};case"complete":return{icon:s.jsx(x,{className:"h-4 w-4 text-emerald-500"}),text:"Siap",color:"bg-emerald-100 text-emerald-700"};case"error":return{icon:s.jsx(m,{className:"h-4 w-4 text-red-500"}),text:"Error",color:"bg-red-100 text-red-700"}}})();return s.jsxs("div",{className:"relative overflow-hidden rounded-xl border border-emerald-100 bg-white shadow-sm",children:[s.jsxs("div",{className:"relative h-32 w-full overflow-hidden bg-gray-100",children:[r?s.jsx("video",{src:a,className:"h-full w-full object-cover"}):s.jsx("img",{src:a,alt:`preview-${t}`,className:"h-full w-full object-cover"}),s.jsxs("button",{type:"button",onClick:()=>(e=>{M(s=>s.filter((s,t)=>t!==e))})(t),className:"absolute right-2 top-2 inline-flex items-center gap-1 rounded-full bg-black/60 px-2 py-1 text-xs font-semibold text-white transition hover:bg-black",children:[s.jsx(d,{className:"h-3 w-3"}),"Hapus"]}),s.jsxs("span",{className:"absolute bottom-2 left-2 rounded-full bg-black/60 px-2 py-1 text-xs font-semibold text-white",children:["#",t+1]})]}),s.jsxs("div",{className:"p-3 space-y-2",children:[s.jsxs("div",{className:`inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-semibold ${i.color}`,children:[i.icon,i.text]}),("processing"===e.status||"uploading"===e.status)&&s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:s.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${e.progress}%`}})}),"complete"===e.status&&!r&&s.jsxs("div",{className:"text-xs text-gray-600",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Original:"}),s.jsx("span",{className:"font-medium",children:l(e.originalSize)})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"WebP:"}),s.jsxs("span",{className:"font-medium text-emerald-600",children:[l(e.compressedSize),e.originalSize&&e.compressedSize&&s.jsxs("span",{className:"ml-1 text-emerald-500",children:["(-",Math.round(100*(1-e.compressedSize/e.originalSize)),"%)"]})]})]})]}),"error"===e.status&&e.error&&s.jsx("p",{className:"text-xs text-red-600",children:e.error})]})]},`${e.originalFile.name}-${t}`)})}):s.jsx("p",{className:"text-sm text-gray-500",children:"No files selected yet."})]}),s.jsxs("div",{className:"rounded-2xl border border-emerald-100 bg-white/70 p-6 shadow-sm",children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold uppercase tracking-wide text-emerald-600",children:"Tips Upload"}),s.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[s.jsx("li",{children:"Format foto: JPG, JPEG, PNG, GIF (maks. 30MB per file)."}),s.jsx("li",{children:"Format video: MP4 atau MOV (maks. 30MB per file)."}),s.jsx("li",{children:"Berikan judul agar memori mudah ditemukan kembali."})]})]}),s.jsxs("div",{className:"flex flex-col gap-4 pt-4 sm:flex-row",children:[s.jsx(o,{href:route("gallery.index",{space:h}),className:"flex-1 rounded-xl border border-gray-300 px-6 py-4 text-center font-medium text-gray-700 transition hover:bg-gray-50",children:"Batal"}),s.jsx("button",{type:"submit",disabled:y||0===F.length||F.some(e=>"processing"===e.status||"pending"===e.status)||!F.some(e=>"complete"===e.status),className:"flex-1 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 px-6 py-4 font-semibold text-white shadow transition hover:shadow-lg disabled:cursor-not-allowed disabled:opacity-60",children:y||F.some(e=>"uploading"===e.status)?"Mengunggah...":F.some(e=>"processing"===e.status)?"Memproses...":"Upload"})]})]})})})]})}export{p as default};
