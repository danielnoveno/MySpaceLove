const e=async e=>{if(!e.type.startsWith("image/"))throw new Error("File is not an image.");if(e.size<=2097152)return e;const t=await(e=>new Promise((t,o)=>{const n=new Image,a=URL.createObjectURL(e);n.onload=()=>{URL.revokeObjectURL(a),t(n)},n.onerror=()=>{URL.revokeObjectURL(a),o(new Error("Failed to load image for conversion."))},n.src=a}))(e),o=Math.min(1,1920/Math.max(t.width,t.height)),n=Math.max(1,Math.round(t.width*o)),a=Math.max(1,Math.round(t.height*o)),r=document.createElement("canvas");r.width=n,r.height=a;const i=r.getContext("2d");if(!i)throw new Error("Could not get canvas context.");i.drawImage(t,0,0,n,a);const s=await new Promise(e=>{r.toBlob(t=>e(t),"image/webp",.72)});if(!s)return e;const c=((e,t)=>{const o=t.split(".").slice(0,-1).join(".")+".webp";return new File([e],o,{type:"image/webp",lastModified:Date.now()})})(s,e.name);return c.size<e.size?c:e};export{e as c};
