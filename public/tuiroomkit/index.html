<!--
 * @Description: 
 * @Date: 2022-03-29 11:09:46
 * @LastEditTime: 2022-04-12 16:45:26
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>TUIRoom</title>
    <script type="text/javascript">
      // ref: https://cn.vitejs.dev/config/build-options.html#build-target
      function isSupportsES6Modules() {
        const script = document.createElement('script');
        if ('noModule' in script) {
          return true;
        }
        script.type = 'module';
        return script.type === 'module';
      }
      function isSupportDynamicImport() {
         try {
          new Function('import("")');
          return true;
        } catch (error) {
          return false;
        }
      }
      if (!isSupportsES6Modules() || !isSupportDynamicImport()) {
        console.error(`isSupportsES6Modules: ${isSupportsES6Modules()}, isSupportDynamicImport: ${isSupportDynamicImport()}.`)
        alert("The current browser failed to load the page, we recommend you use the latest version of chrome browser.");
      }
    </script>
    <script>
      (function () {
        var params = new URLSearchParams(window.location.search);
        var userId = params.get('userId');
        var userName = params.get('userName');
        var avatarUrl = params.get('avatarUrl');
        var sdkAppIdParam = params.get('sdkAppId');
        var userSigParam = params.get('userSig');
        var sdkAppId = sdkAppIdParam && /^\d+$/.test(sdkAppIdParam) ? parseInt(sdkAppIdParam, 10) : undefined;
        var userSig = userSigParam && userSigParam.trim() ? userSigParam.trim() : undefined;

        window.__MYSPACE_ROOM__ = {
          userId: userId && userId.trim() ? userId.trim() : undefined,
          userName: userName && userName.trim() ? userName.trim() : undefined,
          avatarUrl: avatarUrl && avatarUrl.trim() ? avatarUrl.trim() : undefined,
          sdkAppId: sdkAppId,
          userSig: userSig,
        };
      })();
    </script>
    <script type="module" crossorigin src="./assets/index-DVXc8A3U.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/roomEngine-ozIi9Uch.js">
    <link rel="modulepreload" crossorigin href="./assets/roomkit-qngZv_Jb.js">
    <link rel="stylesheet" crossorigin href="./assets/roomkit-ChuLqLgJ.css">
    <link rel="stylesheet" crossorigin href="./assets/index-W0gUjUu0.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        font-family: 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        color-scheme: light;
        --uikit-font-family: 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      body {
        margin: 0;
        font-family: 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(180deg, #fdf2f8 0%, #ffffff 32%, #f8fafc 100%);
        color: #0f172a;
      }

      button,
      input,
      select,
      textarea {
        font-family: 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      #app {
        height: calc(100vh - 72px);
      }

      :root[tui-theme-mode="light"], .tui-theme-light {
        --uikit-color-theme-1: #fdf2f8;
        --uikit-color-theme-2: #fce7f3;
        --uikit-color-theme-3: #fbcfe8;
        --uikit-color-theme-4: #f9a8d4;
        --uikit-color-theme-5: #f472b6;
        --uikit-color-primary: #ec4899;
        --uikit-color-primary-hover: #db2777;
        --uikit-color-success: #22c55e;
        --uikit-color-warning: #f97316;
        --uikit-color-error: #ef4444;
        --uikit-text-color: #1f2937;
        --uikit-font-family: 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;

        --bg-color-default: #ffffff;
        --bg-color-dialog: #ffffff;
        --bg-color-dialog-module: rgba(252, 231, 243, 0.55);
        --bg-color-function: rgba(252, 231, 243, 0.75);
        --bg-color-operate: rgba(236, 72, 153, 0.12);
        --bg-color-topbar: rgba(255, 255, 255, 0.92);
        --bg-color-bottombar: rgba(12, 10, 19, 0.75);
        --bg-color-mask: rgba(15, 23, 42, 0.68);
        --bg-color-entrycard: rgba(253, 242, 248, 0.92);
        --bg-color-element-mask: rgba(236, 72, 153, 0.14);
        --bg-color-tag-mask: rgba(236, 72, 153, 0.12);
        --bg-color-bubble-own: rgba(236, 72, 153, 0.16);
        --bg-color-bubble-reciprocal: rgba(148, 163, 184, 0.22);
        --bg-color-input: rgba(255, 255, 255, 0.88);

        --text-color-primary: #1f2937;
        --text-color-secondary: #475569;
        --text-color-tertiary: #94a3b8;
        --text-color-success: #16a34a;
        --text-color-warning: #d97706;
        --text-color-error: #ef4444;
        --text-color-link: #ec4899;
        --text-color-link-hover: #db2777;
        --text-color-link-active: #be185d;
        --text-color-link-disabled: rgba(236, 72, 153, 0.4);
        --text-color-anti-primary: #ffffff;
        --text-color-anti-secondary: rgba(255, 255, 255, 0.78);
        --text-color-button: #ffffff;
        --text-color-button-disabled: rgba(255, 255, 255, 0.65);

        --button-color-primary-default: #ec4899;
        --button-color-primary-hover: #db2777;
        --button-color-primary-active: #be185d;
        --button-color-primary-disabled: #fbcfe8;
        --button-color-secondary-default: rgba(252, 231, 243, 0.9);
        --button-color-secondary-hover: rgba(249, 168, 212, 0.9);
        --button-color-secondary-active: rgba(236, 72, 153, 0.18);
        --button-color-secondary-disabled: rgba(148, 163, 184, 0.18);

        --checkbox-color-selected: #ec4899;
        --switch-color-on: #ec4899;
        --switch-color-off: rgba(148, 163, 184, 0.5);
        --switch-color-button: #ffffff;
        --slider-color-filled: #ec4899;
        --slider-color-empty: rgba(148, 163, 184, 0.22);
        --slider-color-button: #ec4899;

        --list-color-default: rgba(15, 23, 42, 0.04);
        --list-color-hover: rgba(236, 72, 153, 0.12);
        --list-color-focused: rgba(236, 72, 153, 0.2);
        --dropdown-color-default: rgba(148, 163, 184, 0.12);
        --dropdown-color-hover: rgba(236, 72, 153, 0.15);
        --dropdown-color-active: rgba(236, 72, 153, 0.25);

        --tab-color-unselected: #94a3b8;
        --tab-color-selected: #ec4899;
        --tab-color-option: rgba(253, 242, 248, 0.75);

        --toast-color-default: rgba(15, 23, 42, 0.88);
        --toast-color-success: rgba(16, 185, 129, 0.9);
        --toast-color-error: rgba(239, 68, 68, 0.92);
        --toast-color-warning: rgba(234, 179, 8, 0.9);

        --scroll-bar-color-default: rgba(236, 72, 153, 0.18);
        --scroll-bar-color-hover: rgba(236, 72, 153, 0.35);

        --stroke-color-primary: rgba(236, 72, 153, 0.22);
        --stroke-color-secondary: rgba(148, 163, 184, 0.28);
        --stroke-color-module: rgba(236, 72, 153, 0.12);

        --shadow-color: rgba(236, 72, 153, 0.18);

        --tui-button-active-bg-blue-default: #ec4899;
        --tui-button-active-bg-blue-primary: #db2777;
        --tui-button-active-border-blue-default: transparent;
        --tui-button-active-border-blue-primary: transparent;
        --tui-button-active-text-blue-default: #ffffff;
      }

      .tui-theme-dark {
        --uikit-font-family: 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      :where(.tui-root) {
        font-family: var(--uikit-font-family, 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif);
      }

      :where(.tui-root *) {
        font-family: var(--uikit-font-family, 'Figtree', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif) !important;
      }

      .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .custom-logo {
        height: 46px;
        width: auto;
        filter: drop-shadow(0 12px 30px rgba(236, 72, 153, 0.22));
      }

      .myspace-navbar {
        position: sticky;
        top: 0;
        z-index: 60;
        backdrop-filter: blur(18px);
        background: rgba(255, 255, 255, 0.85);
        border-bottom: 1px solid rgba(236, 72, 153, 0.12);
      }

      .myspace-navbar__brand::after {
        content: '';
        display: block;
        height: 2px;
        width: 64px;
        margin-top: 6px;
        background: linear-gradient(90deg, rgba(236, 72, 153, 0.9), rgba(244, 63, 94, 0.45));
        border-radius: 9999px;
      }

      .myspace-navbar__inner {
        margin: 0 auto;
        max-width: 1100px;
        padding: 20px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
      }

      .myspace-navbar__brand {
        font-weight: 700;
        font-size: 1.125rem;
        color: #ec4899;
        text-decoration: none;
        letter-spacing: 0.12em;
        text-transform: uppercase;
      }

      .myspace-navbar__links {
        display: flex;
        gap: 18px;
        align-items: center;
      }

      .myspace-navbar__links a {
        font-size: 0.85rem;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        text-decoration: none;
        color: #475569;
        transition: color 0.2s ease, transform 0.2s ease;
      }

      .myspace-navbar__links a:hover {
        color: #ec4899;
        transform: translateY(-1px);
      }

      .myspace-navbar__links a[data-active="true"] {
        color: #ec4899;
        font-weight: 600;
      }

      .myspace-navbar__links a[data-active="true"]::after {
        content: '';
        display: block;
        height: 2px;
        margin-top: 6px;
        background: rgba(236, 72, 153, 0.65);
        border-radius: 9999px;
        transform-origin: center;
        animation: nav-underline 0.4s ease;
      }

      @keyframes nav-underline {
        from {
          transform: scaleX(0.35);
          opacity: 0;
        }
        to {
          transform: scaleX(1);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <header class="myspace-navbar">
      <div class="myspace-navbar__inner">
        <a class="myspace-navbar__brand" data-nav-brand href="/">MySpaceLove</a>
        <nav class="myspace-navbar__links">
          <a data-nav="dashboard" href="/">Dashboard</a>
          <a data-nav="timeline" href="/">Timeline</a>
          <a data-nav="gallery" href="/">Galeri</a>
          <a data-nav="journal" href="/">Jurnal</a>
        </nav>
      </div>
    </header>
    <div id="app"></div>
    <script>
      (function () {
        var params = new URLSearchParams(window.location.search);
        var userId = params.get('userId');
        var userName = params.get('userName');
        var avatarUrl = params.get('avatarUrl');
        var spaceSlug = params.get('spaceSlug');
        var spaceTitle = params.get('spaceTitle');
        var dashboardUrl = params.get('dashboardUrl');
        var languageParam = params.get('lang');
        var resolvedLanguage = (languageParam && languageParam.trim()) || 'en-US';

        try {
          document.documentElement.setAttribute('lang', resolvedLanguage);
          localStorage.setItem('tuiRoom-language', resolvedLanguage);
        } catch (error) {
          console.warn('Unable to persist language preference', error);
        }

        document.documentElement.setAttribute('tui-theme-mode', 'light');

        var sanitizedSlug = spaceSlug && spaceSlug.trim() ? spaceSlug.trim() : '';
        var baseDashboard = dashboardUrl && dashboardUrl.trim()
          ? dashboardUrl.trim()
          : (sanitizedSlug ? '/spaces/' + sanitizedSlug + '/dashboard' : '/dashboard');

        var navLinks = {
          dashboard: baseDashboard,
          timeline: sanitizedSlug ? '/spaces/' + sanitizedSlug + '/timeline' : baseDashboard,
          gallery: sanitizedSlug ? '/spaces/' + sanitizedSlug + '/gallery' : '/gallery',
          journal: sanitizedSlug ? '/spaces/' + sanitizedSlug + '/journals' : '/journals',
        };

        window.__MYSPACE_ROOM__ = {
          userId: userId && userId.trim() ? userId.trim() : undefined,
          userName: userName && userName.trim() ? userName.trim() : undefined,
          avatarUrl: avatarUrl && avatarUrl.trim() ? avatarUrl.trim() : undefined,
          sdkAppId: sdkAppId,
          userSig: userSig,
          spaceSlug: sanitizedSlug || null,
          spaceTitle: spaceTitle && spaceTitle.trim() ? spaceTitle.trim() : 'MySpaceLove',
          dashboardUrl: baseDashboard,
          navLinks: navLinks,
          language: resolvedLanguage,
        };

        document.addEventListener('DOMContentLoaded', function () {
          var brand = document.querySelector('[data-nav-brand]');
          if (brand && window.__MYSPACE_ROOM__.spaceTitle) {
            brand.textContent = window.__MYSPACE_ROOM__.spaceTitle + ' - MySpaceLove';
          }
          Object.keys(navLinks).forEach(function (key) {
            var link = document.querySelector('[data-nav="' + key + '"]');
            if (link) {
              link.setAttribute('href', navLinks[key]);
              if (key === 'dashboard') {
                link.setAttribute('data-active', 'true');
              }
            }
          });
        });
      })();
    </script>
    <script>
      (function enhanceDisplayCapture() {
        if (!navigator.mediaDevices || typeof navigator.mediaDevices.getDisplayMedia !== 'function') {
          return;
        }

        const originalGetDisplayMedia = navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);

        function deepMerge(base, override) {
          const output = Array.isArray(base) ? base.slice() : { ...base };

          if (!override || typeof override !== 'object') {
            return output;
          }

          Object.keys(override).forEach(function (key) {
            const overrideValue = override[key];
            if (
              overrideValue &&
              typeof overrideValue === 'object' &&
              !Array.isArray(overrideValue) &&
              !(overrideValue instanceof Date)
            ) {
              const baseValue = Object.prototype.hasOwnProperty.call(output, key) ? output[key] : {};
              output[key] = deepMerge(baseValue, overrideValue);
            } else {
              output[key] = overrideValue;
            }
          });

          return output;
        }

        navigator.mediaDevices.getDisplayMedia = async function patchedGetDisplayMedia(constraints) {
          const baseConstraints = {
            video: {
              cursor: 'always',
              logicalSurface: true,
              preferCurrentTab: false,
              surfaceSwitching: 'include',
            },
            audio: {
              autoGainControl: false,
              echoCancellation: false,
              noiseSuppression: false,
              suppressLocalAudioPlayback: false,
              systemAudio: 'include',
            },
          };

          let normalized = {};
          if (constraints && typeof constraints === 'object') {
            normalized = { ...constraints };
          }

          function buildTrackConfig(baseValue, incomingValue) {
            if (incomingValue === false) {
              return false;
            }

            if (incomingValue === true || incomingValue === undefined) {
              return { ...baseValue };
            }

            if (incomingValue && typeof incomingValue === 'object') {
              return deepMerge(baseValue, incomingValue);
            }

            return { ...baseValue };
          }

          const merged = {
            ...normalized,
            video: buildTrackConfig(baseConstraints.video, normalized.video),
            audio: buildTrackConfig(baseConstraints.audio, normalized.audio),
          };

          try {
            return await originalGetDisplayMedia(merged);
          } catch (error) {
            console.warn('Enhanced display capture failed, falling back to original constraints', error);
            return originalGetDisplayMedia(constraints ?? {});
          }
        };
      })();
    </script>
    <script>
      (function () {
        const MESSAGE_SOURCE = 'tuiroomkit';
        const PARENT_SOURCE = 'myspacelove';
        const OPEN_TYPE = 'schedule:open';
        const CLOSE_TYPE = 'schedule:close';
        const KEYWORDS = ['schedule', 'scheduled', 'jadwal', 'jadwalkan'];
        let activeButton = null;

        function textMatches(value) {
          if (!value) {
            return false;
          }

          const normalized = String(value).trim().toLowerCase();
          if (!normalized) {
            return false;
          }

          return KEYWORDS.some((keyword) => normalized.includes(keyword));
        }

        function matchesScheduleElement(element) {
          if (!(element instanceof HTMLElement)) {
            return false;
          }

          if (element.dataset.myspaceScheduleAttached === '1') {
            return true;
          }

          const role = element.getAttribute('role');
          const isButtonTag = element.tagName === 'BUTTON';
          const isButtonRole = role && role.toLowerCase() === 'button';
          const isFocusable = element.tabIndex >= 0;

          if (!isButtonTag && !isButtonRole && !isFocusable) {
            return false;
          }

          if (textMatches(element.innerText) || textMatches(element.textContent)) {
            return true;
          }

          if (textMatches(element.getAttribute('aria-label'))) {
            return true;
          }

          if (textMatches(element.getAttribute('title'))) {
            return true;
          }

          if (textMatches(element.getAttribute('data-tooltip'))) {
            return true;
          }

          const dataTestId = element.getAttribute('data-testid');
          if (dataTestId && dataTestId.toLowerCase().includes('schedule')) {
            return true;
          }

          const className = element.className;
          if (typeof className === 'string' && className.toLowerCase().includes('schedule')) {
            return true;
          }

          return false;
        }

        function openSchedule(button) {
          if (!(button instanceof HTMLElement)) {
            return;
          }

          if (activeButton && activeButton !== button) {
            activeButton.removeAttribute('data-myspace-schedule-active');
          }

          activeButton = button;
          activeButton.dataset.myspaceScheduleActive = '1';
          document.documentElement.classList.add('myspace-schedule-open');

          try {
            window.parent && window.parent.postMessage({ source: MESSAGE_SOURCE, type: OPEN_TYPE }, window.location.origin);
          } catch (error) {
            console.warn('Unable to notify parent about schedule trigger', error);
          }
        }

        function attachScheduleHandler(element) {
          if (!(element instanceof HTMLElement)) {
            return;
          }

          if (element.dataset.myspaceScheduleAttached === '1') {
            return;
          }

          element.dataset.myspaceScheduleAttached = '1';
          element.dataset.myspaceScheduleButton = '1';

          const handleTrigger = function (event) {
            event.preventDefault();
            if (typeof event.stopImmediatePropagation === 'function') {
              event.stopImmediatePropagation();
            }
            event.stopPropagation();
            openSchedule(element);
          };

          element.addEventListener('click', handleTrigger, true);
          element.addEventListener(
            'keydown',
            function (event) {
              if (event.key === 'Enter' || event.key === ' ') {
                handleTrigger(event);
              }
            },
            true,
          );
        }

        function scanForScheduleButtons(root) {
          if (!(root instanceof HTMLElement)) {
            return;
          }

          const candidates = root.querySelectorAll('button, [role="button"], [tabindex="0"], [data-testid], [class*="schedule"]');
          candidates.forEach((candidate) => {
            if (matchesScheduleElement(candidate)) {
              attachScheduleHandler(candidate);
            }
          });

          if (matchesScheduleElement(root)) {
            attachScheduleHandler(root);
          }
        }

        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'childList') {
              mutation.addedNodes.forEach((node) => {
                if (node instanceof HTMLElement) {
                  scanForScheduleButtons(node);
                }
              });

              mutation.removedNodes.forEach((node) => {
                if (activeButton && node instanceof HTMLElement && node.contains(activeButton)) {
                  activeButton = null;
                  document.documentElement.classList.remove('myspace-schedule-open');
                }
              });
            }

            if (mutation.type === 'attributes' && mutation.target instanceof HTMLElement) {
              scanForScheduleButtons(mutation.target);
            }
          });
        });

        document.addEventListener('DOMContentLoaded', function () {
          scanForScheduleButtons(document.body);
          observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['class', 'aria-label', 'title', 'data-tooltip'],
          });
        });

        window.addEventListener('message', function (event) {
          const expectedOrigin = window.location.origin;
          if (event.origin !== expectedOrigin) {
            return;
          }

          const payload = event.data;
          if (!payload || typeof payload !== 'object') {
            return;
          }

          if (payload.source !== PARENT_SOURCE) {
            return;
          }

          if (payload.type === CLOSE_TYPE) {
            document.documentElement.classList.remove('myspace-schedule-open');
            if (activeButton) {
              activeButton.removeAttribute('data-myspace-schedule-active');
            }
            return;
          }

          if (payload.type === OPEN_TYPE) {
            document.documentElement.classList.add('myspace-schedule-open');
            if (activeButton) {
              activeButton.dataset.myspaceScheduleActive = '1';
            }
          }
        });
      })();
    </script>
    <script>
      const translationMap = {
        'Enter Room': 'Masuk Ruangan',
        'Join Room': 'Gabung Ruangan',
        'Join': 'Gabung',
        'Leave Room': 'Keluar',
        'Leave': 'Keluar',
        'Cancel': 'Batal',
        'Confirm': 'Konfirmasi',
        'Room ID': 'ID Ruangan',
        'Room Name': 'Nama Ruangan',
        'Your name': 'Namamu',
        'Start video': 'Mulai video',
        'Stop video': 'Hentikan video',
        'Microphone': 'Mikrofon',
        'Camera': 'Kamera',
        'Share screen': 'Bagikan layar',
        'Members': 'Peserta',
        'Chat': 'Obrolan',
        'Settings': 'Pengaturan',
        'Room Settings': 'Pengaturan Ruangan',
        'Copy Link': 'Salin Tautan',
        'Copy': 'Salin',
        'Mute': 'Bisukan',
        'Unmute': 'Buka Suara',
        'End Room': 'Akhiri Ruangan',
        'Waiting for host': 'Menunggu host',
        'OK': 'Oke',
      };

      const translationKeys = Object.keys(translationMap);

      function translateNode(node) {
        if (node.nodeType === Node.TEXT_NODE) {
          const text = node.textContent;
          if (!text) return;
          const trimmed = text.trim();
          if (!trimmed) return;
          translationKeys.forEach((key) => {
            if (trimmed === key) {
              node.textContent = node.textContent.replace(key, translationMap[key]);
            }
          });
        } else if (node.nodeType === Node.ELEMENT_NODE) {
          node.childNodes.forEach(translateNode);
        }
      }

      function applyTranslations() {
        translateNode(document.body);
      }

      document.addEventListener('DOMContentLoaded', function () {
        applyTranslations();
        const observer = new MutationObserver(function () {
          applyTranslations();
        });
        observer.observe(document.body, { childList: true, subtree: true });
      });
    </script>
  </body>
</html>
