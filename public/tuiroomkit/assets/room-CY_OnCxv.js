import{d as D,C as G,D as e,y as M,R as o,b as A,c as L,u as b,G as v,o as K}from"./roomkit-qngZv_Jb.js";import{b as w,u as H,g as k,a as y,r as E,o as P,i as F}from"./index-DVXc8A3U.js";import"./roomEngine-ozIi9Uch.js";const x=D({__name:"room",setup(J){const{t:u}=w(),{theme:h}=G(),p=H(),R=sessionStorage.getItem("tuiRoom-roomInfo"),T=sessionStorage.getItem("tuiRoom-userInfo"),n=String(p.query.roomId);e.setLanguage(k()),!h.value&&e.setTheme(y());let I=!1,l=!1;n?R||E.push({path:"home",query:{roomId:n}}):E.push({path:"home"}),M(async()=>{const{action:t,isSeatEnabled:r,roomParam:a,hasCreated:i}=JSON.parse(R),{sdkAppId:c,userId:f,userSig:C,userName:d,avatarUrl:N}=JSON.parse(T);t==="createRoom"&&(I=!0);try{if(await e.login({sdkAppId:c,userId:f,userSig:C}),await e.setSelfInfo({userName:d,avatarUrl:N}),t==="createRoom"&&!i){await e.start(n,{roomName:`${d||f}${u("Quick Conference")}`,isSeatEnabled:r,...a});const O={action:t,roomId:n,roomName:n,isSeatEnabled:r,roomParam:a,hasCreated:!0};sessionStorage.setItem("tuiRoom-roomInfo",JSON.stringify(O))}else await e.join(n,a)}catch{sessionStorage.removeItem("tuiRoom-currentUserInfo")}}),P((t,r,a)=>{var i,c;if(l)a();else{const f=u(I?"This action causes the room to be disbanded, does it continue?":"This action causes the room to be exited, does it continue?");window.confirm(f)?(I?(i=e)==null||i.dismiss():(c=e)==null||c.leave(),a()):a(!1)}});const g=(t,r)=>{sessionStorage.removeItem("tuiRoom-roomInfo"),r&&sessionStorage.removeItem("tuiRoom-currentUserInfo"),U(t)},s=()=>g("home",!1),m=()=>g("home",!0),_=t=>{F.global.locale.value=t,localStorage.setItem("tuiRoom-language",t)},S=t=>{localStorage.setItem("tuiRoom-currentTheme",t)};e.on(o.ROOM_DISMISS,s),e.on(o.ROOM_LEAVE,s),e.on(o.KICKED_OUT,s),e.on(o.ROOM_ERROR,s),e.on(o.KICKED_OFFLINE,s),e.on(o.USER_SIG_EXPIRED,m),e.on(o.USER_LOGOUT,m),e.on(o.LANGUAGE_CHANGED,_),e.on(o.THEME_CHANGED,S),A(()=>{e.off(o.ROOM_DISMISS,s),e.off(o.ROOM_LEAVE,s),e.off(o.KICKED_OUT,s),e.off(o.ROOM_ERROR,s),e.off(o.KICKED_OFFLINE,s),e.off(o.USER_SIG_EXPIRED,m),e.off(o.USER_LOGOUT,m),e.off(o.LANGUAGE_CHANGED,_),e.off(o.THEME_CHANGED,S)});const U=t=>{l=!0,E.replace({path:t})};return(t,r)=>(K(),L(b(v),{"display-mode":"permanent"}))}});export{x as default};
